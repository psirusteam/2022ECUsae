<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.165">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="CEPAL - División de Estadísticas Sociales">

<title>Modelos lineales y mixtos en R y STAN</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="2Modelos Lineal y Mixto_files/libs/clipboard/clipboard.min.js"></script>
<script src="2Modelos Lineal y Mixto_files/libs/quarto-html/quarto.js"></script>
<script src="2Modelos Lineal y Mixto_files/libs/quarto-html/popper.min.js"></script>
<script src="2Modelos Lineal y Mixto_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2Modelos Lineal y Mixto_files/libs/quarto-html/anchor.min.js"></script>
<link href="2Modelos Lineal y Mixto_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2Modelos Lineal y Mixto_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2Modelos Lineal y Mixto_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2Modelos Lineal y Mixto_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2Modelos Lineal y Mixto_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Modelos lineales y mixtos en R y STAN</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>CEPAL - División de Estadísticas Sociales </p>
          </div>
  </div>
    
    
  </div>
  

</header>

<section id="modelos-lineales." class="level2">
<h2 class="anchored" data-anchor-id="modelos-lineales.">Modelos lineales.</h2>
<p>La regresión lineal es la técnica básica del análisis econométrico. Mediante dicha técnica tratamos de determinar relaciones de dependencia de tipo lineal entre una variable dependiente o endógena, respecto de una o varias variables explicativas o exógenas.</p>
<p><span class="math display">\[\begin{align*}
y &amp; = &amp; \boldsymbol{\beta}_{0}+\boldsymbol{\beta}_{1}x+\epsilon \\
E\left(y\mid x\right)&amp; = &amp; B_{0}+B_{1}x
\end{align*}\]</span> donde <span class="math inline">\(B = [B_0, B1]\)</span> y el estimador de <span class="math inline">\(B\)</span> esta dado por:</p>
<p><span class="math display">\[
\hat{B}=\boldsymbol{\left(X^{T}X\right)^{-1}X^{T}y}
\]</span></p>
<section id="práctica-en-r" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-r">Práctica en <strong>R</strong></h3>
<ul>
<li>Encuesta Nacional de Empleo, Desempleo y Subempleo (ENEMDU) 2020</li>
</ul>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-1_b9d6a92284170008c3fee486bab027a7">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>encuesta <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Data/encuestaECU20N.rds"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(edad <span class="sc">&gt;</span> <span class="dv">18</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>tasa_desocupacion <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"Data/tasa_desocupacion2.rds"</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>(datalm <span class="ot">&lt;-</span> encuesta <span class="sc">%&gt;%</span> </span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">provincia =</span> <span class="fu">substr</span>(upm,<span class="dv">1</span>,<span class="dv">2</span>),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  ingcorte) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(provincia) <span class="sc">%&gt;%</span> </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(  <span class="at">Promedio =</span> <span class="fu">mean</span>(ingcorte)) <span class="sc">%&gt;%</span> </span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">left_join</span>(tasa_desocupacion, <span class="at">by =</span> <span class="st">"provincia"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 22%">
<col style="width: 18%">
<col style="width: 17%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">provincia</th>
<th style="text-align: right;">Promedio</th>
<th style="text-align: right;">tasa_desocupacion</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">357.0378</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.3556757</td>
<td style="text-align: right;">10.9913766</td>
<td style="text-align: right;">1.3703170</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: right;">172.5462</td>
<td style="text-align: right;">0.0349977</td>
<td style="text-align: right;">2.5915789</td>
<td style="text-align: right;">12.7377995</td>
<td style="text-align: right;">0.7919954</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03</td>
<td style="text-align: right;">222.0871</td>
<td style="text-align: right;">0.0324975</td>
<td style="text-align: right;">6.8148271</td>
<td style="text-align: right;">17.2045100</td>
<td style="text-align: right;">1.0831176</td>
</tr>
<tr class="even">
<td style="text-align: left;">04</td>
<td style="text-align: right;">170.9905</td>
<td style="text-align: right;">0.0341694</td>
<td style="text-align: right;">3.4306745</td>
<td style="text-align: right;">15.6160896</td>
<td style="text-align: right;">0.6434363</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05</td>
<td style="text-align: right;">253.7146</td>
<td style="text-align: right;">0.0278492</td>
<td style="text-align: right;">4.2777175</td>
<td style="text-align: right;">16.7210164</td>
<td style="text-align: right;">1.0914497</td>
</tr>
<tr class="even">
<td style="text-align: left;">06</td>
<td style="text-align: right;">225.9647</td>
<td style="text-align: right;">0.0310001</td>
<td style="text-align: right;">4.0620089</td>
<td style="text-align: right;">19.9937218</td>
<td style="text-align: right;">0.8190445</td>
</tr>
<tr class="odd">
<td style="text-align: left;">07</td>
<td style="text-align: right;">252.1972</td>
<td style="text-align: right;">0.0479281</td>
<td style="text-align: right;">6.7368356</td>
<td style="text-align: right;">7.6387400</td>
<td style="text-align: right;">1.7057027</td>
</tr>
<tr class="even">
<td style="text-align: left;">08</td>
<td style="text-align: right;">183.4140</td>
<td style="text-align: right;">0.0807891</td>
<td style="text-align: right;">1.3035023</td>
<td style="text-align: right;">0.5808423</td>
<td style="text-align: right;">0.2823164</td>
</tr>
<tr class="odd">
<td style="text-align: left;">09</td>
<td style="text-align: right;">270.9111</td>
<td style="text-align: right;">0.0757444</td>
<td style="text-align: right;">8.5424647</td>
<td style="text-align: right;">21.3529916</td>
<td style="text-align: right;">2.4328615</td>
</tr>
<tr class="even">
<td style="text-align: left;">10</td>
<td style="text-align: right;">182.0704</td>
<td style="text-align: right;">0.0413260</td>
<td style="text-align: right;">4.4626318</td>
<td style="text-align: right;">14.8564755</td>
<td style="text-align: right;">1.3851329</td>
</tr>
<tr class="odd">
<td style="text-align: left;">11</td>
<td style="text-align: right;">202.3867</td>
<td style="text-align: right;">0.0414832</td>
<td style="text-align: right;">1.6513803</td>
<td style="text-align: right;">2.4965808</td>
<td style="text-align: right;">0.7519739</td>
</tr>
<tr class="even">
<td style="text-align: left;">12</td>
<td style="text-align: right;">202.1164</td>
<td style="text-align: right;">0.0532394</td>
<td style="text-align: right;">6.5331386</td>
<td style="text-align: right;">26.8267756</td>
<td style="text-align: right;">1.4074599</td>
</tr>
<tr class="odd">
<td style="text-align: left;">13</td>
<td style="text-align: right;">164.9824</td>
<td style="text-align: right;">0.0707926</td>
<td style="text-align: right;">4.0053499</td>
<td style="text-align: right;">6.1113690</td>
<td style="text-align: right;">1.0532437</td>
</tr>
<tr class="even">
<td style="text-align: left;">14</td>
<td style="text-align: right;">191.7276</td>
<td style="text-align: right;">0.0257662</td>
<td style="text-align: right;">0.4244480</td>
<td style="text-align: right;">0.7334390</td>
<td style="text-align: right;">0.1400808</td>
</tr>
<tr class="odd">
<td style="text-align: left;">15</td>
<td style="text-align: right;">129.2705</td>
<td style="text-align: right;">0.0393621</td>
<td style="text-align: right;">0.8197209</td>
<td style="text-align: right;">3.2186786</td>
<td style="text-align: right;">0.2129319</td>
</tr>
<tr class="even">
<td style="text-align: left;">16</td>
<td style="text-align: right;">276.4899</td>
<td style="text-align: right;">0.0369617</td>
<td style="text-align: right;">0.1500221</td>
<td style="text-align: right;">0.0328186</td>
<td style="text-align: right;">0.0551174</td>
</tr>
<tr class="odd">
<td style="text-align: left;">17</td>
<td style="text-align: right;">348.2340</td>
<td style="text-align: right;">0.0474344</td>
<td style="text-align: right;">9.8771536</td>
<td style="text-align: right;">11.6644321</td>
<td style="text-align: right;">4.2370194</td>
</tr>
<tr class="even">
<td style="text-align: left;">18</td>
<td style="text-align: right;">318.7840</td>
<td style="text-align: right;">0.0239625</td>
<td style="text-align: right;">9.2973846</td>
<td style="text-align: right;">15.4064701</td>
<td style="text-align: right;">1.9608593</td>
</tr>
<tr class="odd">
<td style="text-align: left;">19</td>
<td style="text-align: right;">202.2708</td>
<td style="text-align: right;">0.0316983</td>
<td style="text-align: right;">0.4548855</td>
<td style="text-align: right;">0.4025296</td>
<td style="text-align: right;">0.2653806</td>
</tr>
<tr class="even">
<td style="text-align: left;">20</td>
<td style="text-align: right;">370.0663</td>
<td style="text-align: right;">0.0365037</td>
<td style="text-align: right;">0.1679273</td>
<td style="text-align: right;">5.9221308</td>
<td style="text-align: right;">0.1013912</td>
</tr>
<tr class="odd">
<td style="text-align: left;">21</td>
<td style="text-align: right;">205.0636</td>
<td style="text-align: right;">0.0440635</td>
<td style="text-align: right;">2.8203066</td>
<td style="text-align: right;">0.5174504</td>
<td style="text-align: right;">0.2837308</td>
</tr>
<tr class="even">
<td style="text-align: left;">22</td>
<td style="text-align: right;">190.3220</td>
<td style="text-align: right;">0.0467196</td>
<td style="text-align: right;">2.4074909</td>
<td style="text-align: right;">0.0621846</td>
<td style="text-align: right;">0.1543806</td>
</tr>
<tr class="odd">
<td style="text-align: left;">23</td>
<td style="text-align: right;">278.4515</td>
<td style="text-align: right;">0.0495788</td>
<td style="text-align: right;">4.8919345</td>
<td style="text-align: right;">1.3400514</td>
<td style="text-align: right;">1.9182733</td>
</tr>
<tr class="even">
<td style="text-align: left;">24</td>
<td style="text-align: right;">147.5140</td>
<td style="text-align: right;">0.0829198</td>
<td style="text-align: right;">4.2037463</td>
<td style="text-align: right;">6.1104907</td>
<td style="text-align: right;">1.3361040</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Diagrama de dispersión por las variables</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-2_9ddd9ca4ff24a9c8dd381f62d53ead6b">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>datalm <span class="sc">%&gt;%</span> <span class="fu">gather</span>(<span class="at">key =</span> <span class="st">"Variable"</span>,<span class="at">value =</span> <span class="st">"X"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>                  <span class="sc">-</span>provincia,<span class="sc">-</span>Promedio) <span class="sc">%&gt;%</span> </span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> ., <span class="fu">aes</span>(<span class="at">y =</span> Promedio, <span class="at">x =</span> X)) <span class="sc">+</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(.<span class="sc">~</span>Variable, <span class="at">scales =</span> <span class="st">"free"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-3_ac46d980ff024a10156d7c211fc62a71">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>mod1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(Promedio <span class="sc">~</span> tasa_desocupacion, <span class="at">data =</span> datalm)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Promedio ~ tasa_desocupacion, data = datalm)

Residuals:
    Min      1Q  Median      3Q     Max 
-106.24  -40.70  -19.81   42.29  131.43 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         278.53      38.21   7.290 2.66e-07 ***
tasa_desocupacion -1092.89     804.46  -1.359    0.188    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 65.83 on 22 degrees of freedom
Multiple R-squared:  0.0774,    Adjusted R-squared:  0.03546 
F-statistic: 1.846 on 1 and 22 DF,  p-value: 0.1881</code></pre>
</div>
</div>
</section>
</section>
<section id="modelos-lineales-bayesiano." class="level2">
<h2 class="anchored" data-anchor-id="modelos-lineales-bayesiano.">Modelos lineales bayesiano.</h2>
<p>En primer lugar, nótese que el interés particular recae en la distribución del vector de <span class="math inline">\(n\)</span> variables aleatorias <span class="math inline">\(\mathbf{Y}=(Y_1\ldots,Y_n)'\)</span> condicional a la matriz de variables auxiliares <span class="math inline">\(\mathbf{X}\)</span> e indexada por el vector de parámetros de interés <span class="math inline">\(\boldsymbol{\beta}=(\beta_1,\ldots,\beta_q)'\)</span> dada por <span class="math inline">\(p(\mathbf{Y} \mid \boldsymbol{\beta},\mathbf{X})\)</span>.</p>
<p>El modelo básico y clásico asume que la verosimilitud para las variables de inter’es es</p>
<span class="math display">\[\begin{equation*}
\mathbf{Y} \mid \boldsymbol{\theta},\sigma^2,\mathbf{X}\sim Normal_n(\mathbf{X}\boldsymbol{\beta},\sigma^2\mathbf{I}_n)
\end{equation*}\]</span>
<p>en donde <span class="math inline">\(\mathbf{I}_n\)</span> denota la matriz identidad de orden <span class="math inline">\(n\times n\)</span>. Por supuesto, el modelo normal no es el único que se puede postular como verosimilitud para los datos.</p>
<section id="parámetros-dependientes." class="level3">
<h3 class="anchored" data-anchor-id="parámetros-dependientes.">Parámetros dependientes.</h3>
<p>Los parámetros de interés son <span class="math inline">\(\boldsymbol{\beta}\)</span> y <span class="math inline">\(\sigma^2\)</span> y su distribuciones previa conjunta se supone que está dada por</p>
<span class="math display">\[\begin{equation*}
p(\boldsymbol{\beta},\sigma^2)=p(\boldsymbol{\beta} \mid \sigma^2)p(\sigma^2)
\end{equation*}\]</span>
<p>Específicamente, la distribución previa del parámetro <span class="math inline">\(\boldsymbol{\beta}\)</span> condicionada a <span class="math inline">\(\sigma^2\)</span> es informativa y está regida por la siguiente estructura probabilística <span class="math display">\[\begin{equation*}
\boldsymbol{\beta} \mid \sigma^2 \sim Normal_q(\mathbf{b},\sigma^2\mathbf{B})
\end{equation*}\]</span></p>
<p>en donde <span class="math inline">\(\mathbf{b}\)</span> es un vector de medias y <span class="math inline">\(\mathbf{B}\)</span> es una matriz de varianzas simétrica y definida positiva. Por otro lado, la distribución previa del parámetro <span class="math inline">\(\sigma^2\)</span> también se considera informativa y dada por <span class="math display">\[\begin{equation*}
\sigma^2 \sim Inversa-Gamma\left( \frac{n_0}{2}, \frac{n_0\sigma^2_0}{2} \right)
\end{equation*}\]</span></p>
<p>La distribución posterior conjunta de los parámetros de interés <span class="math inline">\(\boldsymbol{\beta},\sigma^2\)</span> está dada por <span class="math display">\[\begin{align}
p(\boldsymbol{\beta},\sigma^2 \mid \mathbf{Y},\mathbf{X})
&amp;=(\sigma^2)^{-q/2}
\exp\left\{-\frac{1}{2\sigma^2}(\boldsymbol{\beta}-\mathbf{b}_q)'\mathbf{B}_q^{-1}(\boldsymbol{\beta}-\mathbf{b}_q)\right\}
\notag
\\ &amp;\hspace{3cm} \times
(\sigma^2)^{-n_1/2-1}
\exp\left\{-\frac{n_1\sigma^2_1}{2\sigma^2}\right\}
\end{align}\]</span> donde <span class="math display">\[\begin{align*}
\mathbf{B}_q &amp;= \left(\mathbf{B}^{-1}+\mathbf{X}'\mathbf{X}\right)^{-1}\\
\mathbf{b}_q &amp;=\mathbf{B}_q\left(\mathbf{B}^{-1}\mathbf{b}+\mathbf{X}'\mathbf{Y}\right)
\end{align*}\]</span></p>
<p>y además <span class="math display">\[\begin{align*}
n_1&amp;=n_0+n\\
n_1\sigma^2_1&amp;=
n_0\sigma^2_0+(\mathbf{Y}-\mathbf{X}\mathbf{b}_q)'\mathbf{Y}+(\mathbf{b}-\mathbf{b}_q)'\mathbf{B}^{-1}\mathbf{b}
\end{align*}\]</span> donde <span class="math inline">\(n_0\)</span> denota el número de datos previos. La distribución posterior conjunta de los parámetros de interés tiene la forma de la distribución Normal-Gamma.</p>
<p>La distribución posterior del vector de parámetros <span class="math inline">\(\boldsymbol{\beta}\)</span> condicionada a <span class="math inline">\(\sigma^2,\mathbf{Y},\mathbf{X}\)</span> es <span class="math display">\[\begin{equation*}
\boldsymbol{\beta} \mid \sigma^2,\mathbf{Y},\mathbf{X} \sim Normal_q(\mathbf{b}_q,\sigma^2\mathbf{B}_q)
\end{equation*}\]</span></p>
<p>La distribución posterior del parámetro <span class="math inline">\(\sigma^2\)</span> condicionada es <span class="math display">\[\begin{equation*}
\sigma^2 \mid \mathbf{Y},\mathbf{X} \sim Inversa-Gamma\left(\frac{n_1}{2},\frac{\sigma^2_1}{2}\right)
\end{equation*}\]</span></p>
</section>
<section id="parámetros-independientes" class="level3">
<h3 class="anchored" data-anchor-id="parámetros-independientes">Parámetros independientes</h3>
<p>En esta ocasión se considera que los parámetros son independientes previa; es decir que la distribución previa conjunta está dada por <span class="math display">\[\begin{equation*}
p(\boldsymbol{\beta},\sigma^2)=p(\boldsymbol{\beta})p(\sigma^2)
\end{equation*}\]</span></p>
<p>Como es natural, la distribución previa del vector de parámetros <span class="math inline">\(\boldsymbol{\beta}\)</span> es normal, aunque esta vez la matriz de varianzas no va a depender del otro parámetro <span class="math inline">\(\sigma^2\)</span>, por lo tanto se tiene que <span class="math display">\[\begin{equation*}
\boldsymbol{\beta} \sim Normal_q(\mathbf{b},\mathbf{B})
\end{equation*}\]</span></p>
<p>Igualmente, el parámetro <span class="math inline">\(\sigma^2\)</span> no depende de <span class="math inline">\(\boldsymbol{\beta}\)</span> y es posible asignarle la siguiente distribución previa <span class="math display">\[\begin{equation*}
\sigma^2\sim Inversa-Gamma\left(\frac{n_0}{2},\frac{n_0\sigma^2_0}{2}\right)
\end{equation*}\]</span></p>
<p>la distribución posterior conjunta de <span class="math inline">\(\boldsymbol{\beta}\)</span> y <span class="math inline">\(\sigma^2\)</span> puede ser escrita como <span class="math display">\[\begin{align}
p(\boldsymbol{\beta},\sigma^2 \mid \mathbf{Y},\mathbf{X})&amp;\propto p(\mathbf{Y} \mid \boldsymbol{\beta},\sigma^2)p(\boldsymbol{\beta})p(\sigma^2)\notag \\
&amp;\propto (\sigma^2)^{-n/2} \exp\left\{-\frac{1}{2\sigma^2}\left(Q(\boldsymbol{\beta})+S^2_e\right)\right\}\notag\\
&amp;\times
\exp\left\{-\frac{1}{2}(\boldsymbol{\beta}-\mathbf{b})'\mathbf{B}^{-1}(\boldsymbol{\beta}-\mathbf{b})\right\}
(\sigma^2)^{-n_0/2-1} \exp\left\{-\frac{n_0\sigma^2_0}{2\sigma^2}\right\}\notag\\
&amp;=(\sigma^2)^{-\frac{n+n_0}{2}-1}
\exp\left\{-\frac{1}{2\sigma^2}\left[Q(\boldsymbol{\beta})+S^2_e+n_0\sigma^2_0\right]\right\} \notag \\
&amp;\times
\exp\left\{-\frac{1}{2}(\boldsymbol{\beta}-\mathbf{b})'\mathbf{B}^{-1}(\boldsymbol{\beta}-\mathbf{b})\right\}
\end{align}\]</span></p>
<p>La distribución posterior del parámetro <span class="math inline">\(\boldsymbol{\beta}\)</span> condicionado a <span class="math inline">\(\sigma^2,\mathbf{Y},\mathbf{X}\)</span> es <span class="math display">\[\begin{equation*}
\boldsymbol{\beta} \mid \sigma^2,\mathbf{Y},\mathbf{X} \sim Normal_q(\mathbf{b}_q,\mathbf{B}_q)
\end{equation*}\]</span></p>
<p>donde <span class="math display">\[\begin{align*}
\mathbf{B}_q &amp;= \left(\mathbf{B}^{-1}+\frac{1}{\sigma^2}\mathbf{X}'\mathbf{X}\right)^{-1}\\
\mathbf{b}_q &amp;=\mathbf{B}_q\left(\mathbf{B}^{-1}\mathbf{b}+\frac{1}{\sigma^2}\mathbf{X}'\mathbf{Y}\right)
\end{align*}\]</span></p>
<p>La distribución posterior del parámetro <span class="math inline">\(\sigma^2\)</span> condicionado a <span class="math inline">\(\boldsymbol{\beta},\mathbf{Y},\mathbf{X}\)</span> es <span class="math display">\[\begin{equation*}
\sigma^2 \mid \boldsymbol{\beta},\mathbf{Y},\mathbf{X} \sim Inversa-Gamma\left( \frac{n_1}{2}, \frac{n_1\sigma_{\boldsymbol{\beta}}^2}{2}  \right)
\end{equation*}\]</span></p>
<p>donde <span class="math inline">\(n_1=n+n_0\)</span> <span class="math display">\[\begin{align*}
n_1\sigma_{\boldsymbol{\beta}}^2&amp;=&amp;Q(\boldsymbol{\beta})+S^2_e+n_0\sigma^2_0\\
Q(\boldsymbol{\beta})&amp;=&amp;(\boldsymbol{\beta}-\hat{\boldsymbol{\beta}})'(\mathbf{X}'\mathbf{X})(\boldsymbol{\beta}-\hat{\boldsymbol{\beta}})\\
S^2_e&amp;=&amp;(\mathbf{y}-\mathbf{X}\hat{\boldsymbol{\beta}})'(\mathbf{y}-\mathbf{X}\hat{\boldsymbol{\beta}})
\end{align*}\]</span> y <span class="math inline">\(\sigma^2_0\)</span> es una estimación previa del parámetro de interés <span class="math inline">\(\sigma^2\)</span>.</p>
</section>
<section id="práctica-en-stan-modelo-lineal-simple" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-stan-modelo-lineal-simple">Práctica en <strong>STAN</strong> (Modelo lineal simple)</h3>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-4_0ce47af60cc32ed09b3f83ced419b1d0">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> n;   <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  vector[n] x;      <span class="sc">/</span><span class="er">/</span> Variable predictora</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  vector[n] y;      <span class="sc">/</span><span class="er">/</span> Variable respuesta</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  real b0;            <span class="sc">/</span><span class="er">/</span> Intercepto</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>  real b1;            <span class="sc">/</span><span class="er">/</span> Pendiente</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>  real<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> sigma;  <span class="sc">/</span><span class="er">/</span> error scale</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  b0 <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">250</span>, <span class="dv">100</span>);</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  b1 <span class="sc">~</span> <span class="fu">normal</span>(<span class="sc">-</span><span class="dv">1000</span>, <span class="dv">100</span>);</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">cauchy</span>(<span class="dv">60</span>, <span class="dv">15</span>); </span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">normal</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x, sigma);  <span class="sc">/</span><span class="er">/</span> likelihood</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>generated quantities {</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>    real ypred[n];                    <span class="sc">/</span><span class="er">/</span> vector de longitud n</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>    ypred <span class="ot">=</span> <span class="fu">normal_rng</span>(b0 <span class="sc">+</span> b1<span class="sc">*</span>x, sigma);</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-5_21e760270a1b57a76375296c1d33186a">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(cmdstanr)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="do">## Definir el modelo</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>fitLm1 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/ModeloLm1.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-6_091397a51a3d9563a6a7f1db0b449fa9">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">nrow</span>(datalm),</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> datalm<span class="sc">$</span>tasa_desocupacion,</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> datalm<span class="sc">$</span>Promedio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-7_2823535c54784f3db95ff1778b0399f6">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>model_fitLm1 <span class="ot">&lt;-</span> fitLm1<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> sample_data, </span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.7 seconds.
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 0.6 seconds.
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 0.6 seconds.
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 0.5 seconds.

All 4 chains finished successfully.
Mean chain execution time: 0.6 seconds.
Total execution time: 1.9 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-8_f0818d9eb4fcafccbb2842472821ba22">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>model_fitLm1<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"b0"</span>,<span class="st">"b1"</span>,<span class="st">"sigma"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">b0</td>
<td style="text-align: right;">274.17378</td>
<td style="text-align: right;">274.1560</td>
<td style="text-align: right;">13.929965</td>
<td style="text-align: right;">13.864534</td>
<td style="text-align: right;">251.38450</td>
<td style="text-align: right;">296.94025</td>
<td style="text-align: right;">1.001661</td>
<td style="text-align: right;">2911.175</td>
<td style="text-align: right;">2639.049</td>
</tr>
<tr class="even">
<td style="text-align: left;">b1</td>
<td style="text-align: right;">-1004.89988</td>
<td style="text-align: right;">-1005.1100</td>
<td style="text-align: right;">98.853242</td>
<td style="text-align: right;">98.292674</td>
<td style="text-align: right;">-1170.18900</td>
<td style="text-align: right;">-843.82295</td>
<td style="text-align: right;">1.000842</td>
<td style="text-align: right;">3347.027</td>
<td style="text-align: right;">2631.951</td>
</tr>
<tr class="odd">
<td style="text-align: left;">sigma</td>
<td style="text-align: right;">64.92611</td>
<td style="text-align: right;">64.0068</td>
<td style="text-align: right;">8.474648</td>
<td style="text-align: right;">7.708927</td>
<td style="text-align: right;">52.91375</td>
<td style="text-align: right;">80.01717</td>
<td style="text-align: right;">1.000515</td>
<td style="text-align: right;">2988.305</td>
<td style="text-align: right;">2276.543</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-9_d9e51b0ef83644f93321966737fb6ad1">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(posterior)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bayesplot)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(patchwork)</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"b0"</span>)) <span class="sc">+</span></span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"b0"</span>)))<span class="sc">/</span> </span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"b0"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-10_75cbf7c088869129700333f679f3e6c8">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"b1"</span>)) <span class="sc">+</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"b1"</span>)))<span class="sc">/</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"b1"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-11_8b9a7c4704932ab3791a3d37d1e16c2a">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma"</span>)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma"</span>)))<span class="sc">/</span> </span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-12_8e51361f2fd0384e5e0b240f5513f97f">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datalm)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"ypred"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, <span class="dv">1</span><span class="sc">:</span>n]</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(datalm<span class="sc">$</span>Promedio), y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="práctica-en-stan-modelo-lineal-múltiple" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-stan-modelo-lineal-múltiple">Práctica en <strong>STAN</strong> (modelo lineal múltiple)</h3>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-13_3e95501fc4087e7acd69d8a4e78848ca">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> n;   <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> K;   <span class="sc">/</span><span class="er">/</span> Número de predictores</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  matrix[n, K] x;   <span class="sc">/</span><span class="er">/</span> Matrix de predictores</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  vector[n] y;      <span class="sc">/</span><span class="er">/</span> Vector respuesta</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  vector[K] beta;       </span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  real<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> sigma;  </span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">to_vector</span>(beta) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">250</span>, <span class="dv">10000</span>);</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">cauchy</span>(<span class="dv">1</span>, <span class="dv">100</span>); </span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">normal</span>(x <span class="sc">*</span> beta, sigma);  <span class="sc">/</span><span class="er">/</span> likelihood</span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a>generated quantities {</span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>    real ypred[n];                    <span class="sc">/</span><span class="er">/</span> vector de longitud n</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>    ypred <span class="ot">=</span> <span class="fu">normal_rng</span>(x <span class="sc">*</span> beta, sigma);</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-14_042f828c3d68962cec859bfa8d183153">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>fitLm2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/ModeloLm2.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-15_d80bf27534ed8de943d2925f97e5a8a6">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>(Xdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Promedio <span class="sc">~</span> tasa_desocupacion <span class="sc">+</span> Luces_nocturna <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>                       Suelo_cultivo <span class="sc">+</span> Suelo_urbano,<span class="at">data =</span> datalm))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 16%">
<col style="width: 25%">
<col style="width: 20%">
<col style="width: 19%">
<col style="width: 18%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">(Intercept)</th>
<th style="text-align: right;">tasa_desocupacion</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.3556757</td>
<td style="text-align: right;">10.9913766</td>
<td style="text-align: right;">1.3703170</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0349977</td>
<td style="text-align: right;">2.5915789</td>
<td style="text-align: right;">12.7377995</td>
<td style="text-align: right;">0.7919954</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0324975</td>
<td style="text-align: right;">6.8148271</td>
<td style="text-align: right;">17.2045100</td>
<td style="text-align: right;">1.0831176</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0341694</td>
<td style="text-align: right;">3.4306745</td>
<td style="text-align: right;">15.6160896</td>
<td style="text-align: right;">0.6434363</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0278492</td>
<td style="text-align: right;">4.2777175</td>
<td style="text-align: right;">16.7210164</td>
<td style="text-align: right;">1.0914497</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0310001</td>
<td style="text-align: right;">4.0620089</td>
<td style="text-align: right;">19.9937218</td>
<td style="text-align: right;">0.8190445</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0479281</td>
<td style="text-align: right;">6.7368356</td>
<td style="text-align: right;">7.6387400</td>
<td style="text-align: right;">1.7057027</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0807891</td>
<td style="text-align: right;">1.3035023</td>
<td style="text-align: right;">0.5808423</td>
<td style="text-align: right;">0.2823164</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0757444</td>
<td style="text-align: right;">8.5424647</td>
<td style="text-align: right;">21.3529916</td>
<td style="text-align: right;">2.4328615</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0413260</td>
<td style="text-align: right;">4.4626318</td>
<td style="text-align: right;">14.8564755</td>
<td style="text-align: right;">1.3851329</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0414832</td>
<td style="text-align: right;">1.6513803</td>
<td style="text-align: right;">2.4965808</td>
<td style="text-align: right;">0.7519739</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0532394</td>
<td style="text-align: right;">6.5331386</td>
<td style="text-align: right;">26.8267756</td>
<td style="text-align: right;">1.4074599</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0707926</td>
<td style="text-align: right;">4.0053499</td>
<td style="text-align: right;">6.1113690</td>
<td style="text-align: right;">1.0532437</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0257662</td>
<td style="text-align: right;">0.4244480</td>
<td style="text-align: right;">0.7334390</td>
<td style="text-align: right;">0.1400808</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0393621</td>
<td style="text-align: right;">0.8197209</td>
<td style="text-align: right;">3.2186786</td>
<td style="text-align: right;">0.2129319</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0369617</td>
<td style="text-align: right;">0.1500221</td>
<td style="text-align: right;">0.0328186</td>
<td style="text-align: right;">0.0551174</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0474344</td>
<td style="text-align: right;">9.8771536</td>
<td style="text-align: right;">11.6644321</td>
<td style="text-align: right;">4.2370194</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0239625</td>
<td style="text-align: right;">9.2973846</td>
<td style="text-align: right;">15.4064701</td>
<td style="text-align: right;">1.9608593</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0316983</td>
<td style="text-align: right;">0.4548855</td>
<td style="text-align: right;">0.4025296</td>
<td style="text-align: right;">0.2653806</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0365037</td>
<td style="text-align: right;">0.1679273</td>
<td style="text-align: right;">5.9221308</td>
<td style="text-align: right;">0.1013912</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0440635</td>
<td style="text-align: right;">2.8203066</td>
<td style="text-align: right;">0.5174504</td>
<td style="text-align: right;">0.2837308</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0467196</td>
<td style="text-align: right;">2.4074909</td>
<td style="text-align: right;">0.0621846</td>
<td style="text-align: right;">0.1543806</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0495788</td>
<td style="text-align: right;">4.8919345</td>
<td style="text-align: right;">1.3400514</td>
<td style="text-align: right;">1.9182733</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0.0829198</td>
<td style="text-align: right;">4.2037463</td>
<td style="text-align: right;">6.1104907</td>
<td style="text-align: right;">1.3361040</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-16_ad27f6f8b699108469383d364e2e152a">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">nrow</span>(datalm),</span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> <span class="fu">ncol</span>(Xdat),</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">as.matrix</span>(Xdat),</span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> datalm<span class="sc">$</span>Promedio)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-17_443e7f275aa4c701ce7789f7933828e3">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>model_fitLm2 <span class="ot">&lt;-</span> fitLm2<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> sample_data, </span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 0.0 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 0.0 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 1.9 seconds.
Chain 2 finished in 1.9 seconds.
Chain 3 finished in 1.9 seconds.
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 1.2 seconds.

All 4 chains finished successfully.
Mean chain execution time: 1.7 seconds.
Total execution time: 3.5 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-18_71d3cc204a328bad4d966eda411b83ba">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>model_fitLm2<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta"</span>,<span class="st">"sigma"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta[1]</td>
<td style="text-align: right;">265.418772</td>
<td style="text-align: right;">265.026000</td>
<td style="text-align: right;">41.371431</td>
<td style="text-align: right;">40.477204</td>
<td style="text-align: right;">198.597250</td>
<td style="text-align: right;">333.359300</td>
<td style="text-align: right;">1.000278</td>
<td style="text-align: right;">1908.315</td>
<td style="text-align: right;">2295.886</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2]</td>
<td style="text-align: right;">-1611.562265</td>
<td style="text-align: right;">-1615.155000</td>
<td style="text-align: right;">803.624790</td>
<td style="text-align: right;">787.868466</td>
<td style="text-align: right;">-2901.907500</td>
<td style="text-align: right;">-306.241350</td>
<td style="text-align: right;">1.000186</td>
<td style="text-align: right;">1942.191</td>
<td style="text-align: right;">2085.221</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[3]</td>
<td style="text-align: right;">5.557629</td>
<td style="text-align: right;">5.666935</td>
<td style="text-align: right;">11.896116</td>
<td style="text-align: right;">11.194134</td>
<td style="text-align: right;">-13.697245</td>
<td style="text-align: right;">25.394745</td>
<td style="text-align: right;">1.000479</td>
<td style="text-align: right;">1521.268</td>
<td style="text-align: right;">1857.212</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[4]</td>
<td style="text-align: right;">-2.079769</td>
<td style="text-align: right;">-2.053510</td>
<td style="text-align: right;">2.391063</td>
<td style="text-align: right;">2.241476</td>
<td style="text-align: right;">-6.125464</td>
<td style="text-align: right;">1.870038</td>
<td style="text-align: right;">1.000877</td>
<td style="text-align: right;">2299.790</td>
<td style="text-align: right;">2137.508</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[5]</td>
<td style="text-align: right;">30.753719</td>
<td style="text-align: right;">30.516750</td>
<td style="text-align: right;">31.629449</td>
<td style="text-align: right;">29.611451</td>
<td style="text-align: right;">-21.235080</td>
<td style="text-align: right;">84.073785</td>
<td style="text-align: right;">1.000524</td>
<td style="text-align: right;">1716.409</td>
<td style="text-align: right;">1786.274</td>
</tr>
<tr class="even">
<td style="text-align: left;">sigma</td>
<td style="text-align: right;">61.829009</td>
<td style="text-align: right;">60.309700</td>
<td style="text-align: right;">10.747497</td>
<td style="text-align: right;">9.822299</td>
<td style="text-align: right;">47.177575</td>
<td style="text-align: right;">81.875200</td>
<td style="text-align: right;">1.001383</td>
<td style="text-align: right;">1798.679</td>
<td style="text-align: right;">2242.951</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-19_85f8b6c873e27b6a2ac21a3632e709f6">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[1]"</span>)) <span class="sc">+</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[1]"</span>)))<span class="sc">/</span> </span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[1]"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-20_1b73d1ed74a48e6813d98c9088d9b843">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[2]"</span>)) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[2]"</span>)))<span class="sc">/</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[2]"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-21_1c485acb71b3da9601c18f06315b7e6d">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[3]"</span>)) <span class="sc">+</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[3]"</span>)))<span class="sc">/</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[3]"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-22_58abf2eb65a26d6585d7c4a8e98628ae">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[4]"</span>)) <span class="sc">+</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[4]"</span>)))<span class="sc">/</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta[4]"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-23_3f7ca3e19741b6c32c26b081df7af0de">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>(<span class="fu">mcmc_dens_chains</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma"</span>)) <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma"</span>)))<span class="sc">/</span> </span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_fitLm1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"sigma"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-24_6b319991286b96e9b445afc0b9f680f0">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datalm)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_fitLm2<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"ypred"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, <span class="dv">1</span><span class="sc">:</span>n]</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(datalm<span class="sc">$</span>Promedio), y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-24-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="modelo-lineal-generalizado" class="level1">
<h1>Modelo lineal generalizado</h1>
<section id="modelo-bernoulli-con-vínculo-logístico" class="level2">
<h2 class="anchored" data-anchor-id="modelo-bernoulli-con-vínculo-logístico">Modelo Bernoulli con vínculo logístico</h2>
<p>Este caso es típico en donde la variable respuesta sólo toma dos valores, uno en caso de un evento exitoso y cero, cuando se presenta un fracaso. Se supone que <span class="math inline">\(\mathbf{Y}=\{Y_1, \ldots, Y_n\}\)</span> es un conjunto de variables aleatorias intercambiables cada una con distribución bernoulli de parámetro <span class="math inline">\(\theta_i\)</span>, y se quiere estudiar la relación entre <span class="math inline">\(\theta_i\)</span> y las variables auxiliares <span class="math inline">\(\mathbf{X}_i\)</span> por medio de la función de enlace <span class="math inline">\(g(\theta_i)=\mathbf{X}_i'\boldsymbol{\beta}\)</span>. Aquí consideramos la función de enlace logística</p>
<span class="math display">\[\begin{equation}
\eta_i=g(\theta_i)=logit(\theta_i)=\log\left(\frac{\theta_i}{1-\theta_i}\right)
\end{equation}\]</span>
<p>fácilmente se encuentra que la función inversa para <span class="math inline">\(g(\cdot)\)</span>, está dada por</p>
<span class="math display">\[\begin{equation*}
\theta_i=g^{-1}(\eta_i)=\frac{\exp(\eta_i)}{1+\exp(\eta_i)}
\end{equation*}\]</span>
<p>Notando que <span class="math inline">\(\eta_i=\mathbf{X}_i'\boldsymbol{\beta}\)</span> y siguiendo con el modelamiento, se tiene que la verosimilitud de los datos está dada por <span class="math display">\[\begin{align}
p(\mathbf{Y}\mid \boldsymbol{\theta})&amp;=\prod_{i=1}^n\theta_i^{y_i}(1-\theta_i)^{1-y_i} \notag \\
p(\mathbf{Y}\mid \boldsymbol{\beta})&amp;=\prod_{i=1}^n\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)^{y_i}
\left(1-\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)\right)^{1-y_i}
\end{align}\]</span></p>
<p>Suponga que la distribución a previa para <span class="math inline">\(\boldsymbol{\beta}\)</span> está regida por la siguiente estructura probabilística <span class="math display">\[\begin{equation*}
\boldsymbol{\beta}\sim Normal_q(\mathbf{b},\mathbf{B})
\end{equation*}\]</span></p>
<p>De esta manera, la distribución a posterior toma la siguiente forma. <span class="math display">\[\begin{align*}
p(\boldsymbol{\beta} \mid \mathbf{Y}, \mathbf{X})&amp;\propto
\prod_{i=1}^n\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)^{y_i}
\left(1-\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)\right)^{1-y_i}\\
&amp;\hspace{2cm}\times
\exp\left\{\frac{-1}{2}(\boldsymbol{\beta}-\mathbf{b})'\mathbf{B}^{-1}(\boldsymbol{\beta}-\mathbf{b})\right\}
\end{align*}\]</span></p>
<p>La anterior expresión no tiene una forma cerrada y no es sencillo, en primera instancia, simular observaciones u obtener inferencias a posterior.</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-25_1eac6be88e661ed7696020336d9e1aaa">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>datalogit <span class="ot">&lt;-</span> encuesta <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">provincia =</span> <span class="fu">substr</span>(upm, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">pobreza =</span> <span class="fu">ifelse</span>(ingcorte <span class="sc">&lt;</span> lp, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">sexo =</span> <span class="fu">as_factor</span>(sexo),  </span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">anoest =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">|</span> <span class="fu">is.na</span>(anoest)   <span class="sc">~</span> <span class="st">"98"</span>  , <span class="co">#No aplica</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">==</span> <span class="dv">99</span> <span class="sc">~</span> <span class="st">"99"</span>, <span class="co">#NS/NR</span></span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">==</span> <span class="dv">0</span>  <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># Sin educacion</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">~</span> <span class="st">"2"</span>,       <span class="co"># 1 - 6</span></span>
<span id="cb28-12"><a href="#cb28-12" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">~</span> <span class="st">"3"</span>,      <span class="co"># 7 - 12</span></span>
<span id="cb28-13"><a href="#cb28-13" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">&gt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"4"</span>,      <span class="co"># mas de 12</span></span>
<span id="cb28-14"><a href="#cb28-14" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Error"</span>  ),</span>
<span id="cb28-15"><a href="#cb28-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb28-16"><a href="#cb28-16" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> <span class="fu">case_when</span>(</span>
<span id="cb28-17"><a href="#cb28-17" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb28-18"><a href="#cb28-18" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"2"</span>,</span>
<span id="cb28-19"><a href="#cb28-19" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"3"</span>,</span>
<span id="cb28-20"><a href="#cb28-20" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"4"</span>,</span>
<span id="cb28-21"><a href="#cb28-21" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"5"</span>),</span>
<span id="cb28-22"><a href="#cb28-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb28-23"><a href="#cb28-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(provincia <span class="sc">==</span><span class="st">"01"</span>, anoest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>))</span>
<span id="cb28-24"><a href="#cb28-24" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(datalogit)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: left;">provincia</th>
<th style="text-align: right;">pobreza</th>
<th style="text-align: left;">sexo</th>
<th style="text-align: left;">anoest</th>
<th style="text-align: left;">edad</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Hombre</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">4</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="even">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1</td>
<td style="text-align: left;">Hombre</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">2</td>
</tr>
</tbody>
</table>
</div>
</div>
<section id="práctica-en-stan" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-stan">Práctica en <strong>STAN</strong></h3>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-26_e14972310a95c95b94070d334871ee88">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> n;   <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> K;   <span class="sc">/</span><span class="er">/</span> Número de predictores</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  matrix[n, K] x;   <span class="sc">/</span><span class="er">/</span> Matrix de predictores</span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a>  int y;      <span class="sc">/</span><span class="er">/</span> Vector respuesta</span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a>  vector[K] beta;       <span class="sc">/</span><span class="er">/</span> coefficients <span class="cf">for</span> predictors</span>
<span id="cb29-9"><a href="#cb29-9" aria-hidden="true" tabindex="-1"></a>  real<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> sigma;  <span class="sc">/</span><span class="er">/</span> error scale</span>
<span id="cb29-10"><a href="#cb29-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-11"><a href="#cb29-11" aria-hidden="true" tabindex="-1"></a>transformed parameters {</span>
<span id="cb29-12"><a href="#cb29-12" aria-hidden="true" tabindex="-1"></a>    vector[n] inv_eta;</span>
<span id="cb29-13"><a href="#cb29-13" aria-hidden="true" tabindex="-1"></a>   inv_eta <span class="ot">=</span> <span class="fu">inv_logit</span>(x <span class="sc">*</span> beta);</span>
<span id="cb29-14"><a href="#cb29-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-15"><a href="#cb29-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-16"><a href="#cb29-16" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb29-17"><a href="#cb29-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">to_vector</span>(beta) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10000</span>);</span>
<span id="cb29-18"><a href="#cb29-18" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">bernoulli</span>(inv_eta);  <span class="sc">/</span><span class="er">/</span> likelihood</span>
<span id="cb29-19"><a href="#cb29-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb29-20"><a href="#cb29-20" aria-hidden="true" tabindex="-1"></a>generated quantities {</span>
<span id="cb29-21"><a href="#cb29-21" aria-hidden="true" tabindex="-1"></a>    real ypred[n];                    <span class="sc">/</span><span class="er">/</span> vector de longitud n</span>
<span id="cb29-22"><a href="#cb29-22" aria-hidden="true" tabindex="-1"></a>    ypred <span class="ot">=</span> <span class="fu">bernoulli_rng</span>(inv_eta);</span>
<span id="cb29-23"><a href="#cb29-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-27_769de6ef07b803625130d63d185112dc">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>fitLosgit1 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/ModeloLogit.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-28_f187f2a6d2644ad68c29364b9ab218f0">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>Xdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(pobreza <span class="sc">~</span> sexo<span class="sc">+</span>anoest<span class="sc">+</span>edad,</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> datalogit)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Xdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">(Intercept)</th>
<th style="text-align: right;">sexoMujer</th>
<th style="text-align: right;">anoest2</th>
<th style="text-align: right;">anoest3</th>
<th style="text-align: right;">anoest4</th>
<th style="text-align: right;">edad3</th>
<th style="text-align: right;">edad4</th>
<th style="text-align: right;">edad5</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-29_e901608fe40fe63aecd183bde55ac993">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">n =</span> <span class="fu">nrow</span>(datalogit),</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> <span class="fu">ncol</span>(Xdat),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">as.matrix</span>(Xdat),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> datalogit<span class="sc">$</span>pobreza)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-30_463b2f360a4dbc48fe9a52b7e165a7e6">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>model_Losgit1 <span class="ot">&lt;-</span> fitLosgit1<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> sample_data, </span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 36.0 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 38.7 seconds.
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 38.5 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 40.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 38.3 seconds.
Total execution time: 41.3 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-31_90d6248cfab7073834ee1845ddcd1903">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>model_Losgit1<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta[1]</td>
<td style="text-align: right;">-1.8668356</td>
<td style="text-align: right;">-1.8536700</td>
<td style="text-align: right;">0.5192243</td>
<td style="text-align: right;">0.5059966</td>
<td style="text-align: right;">-2.7929670</td>
<td style="text-align: right;">-1.0757150</td>
<td style="text-align: right;">1.138902</td>
<td style="text-align: right;">21.50429</td>
<td style="text-align: right;">96.34832</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2]</td>
<td style="text-align: right;">0.1758698</td>
<td style="text-align: right;">0.1813405</td>
<td style="text-align: right;">0.1365299</td>
<td style="text-align: right;">0.1342509</td>
<td style="text-align: right;">-0.0583146</td>
<td style="text-align: right;">0.3927119</td>
<td style="text-align: right;">1.014844</td>
<td style="text-align: right;">367.13256</td>
<td style="text-align: right;">516.46278</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[3]</td>
<td style="text-align: right;">0.8208145</td>
<td style="text-align: right;">0.8002030</td>
<td style="text-align: right;">0.5076228</td>
<td style="text-align: right;">0.5073702</td>
<td style="text-align: right;">0.0096311</td>
<td style="text-align: right;">1.6662430</td>
<td style="text-align: right;">1.153721</td>
<td style="text-align: right;">18.31885</td>
<td style="text-align: right;">84.58734</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[4]</td>
<td style="text-align: right;">0.1743021</td>
<td style="text-align: right;">0.1535950</td>
<td style="text-align: right;">0.5111367</td>
<td style="text-align: right;">0.5065177</td>
<td style="text-align: right;">-0.6129862</td>
<td style="text-align: right;">1.0276135</td>
<td style="text-align: right;">1.145691</td>
<td style="text-align: right;">19.67912</td>
<td style="text-align: right;">101.97158</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[5]</td>
<td style="text-align: right;">-0.7013736</td>
<td style="text-align: right;">-0.7245540</td>
<td style="text-align: right;">0.5165915</td>
<td style="text-align: right;">0.5269412</td>
<td style="text-align: right;">-1.5173955</td>
<td style="text-align: right;">0.1833553</td>
<td style="text-align: right;">1.158164</td>
<td style="text-align: right;">18.14842</td>
<td style="text-align: right;">93.34145</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[6]</td>
<td style="text-align: right;">-0.2027496</td>
<td style="text-align: right;">-0.2058860</td>
<td style="text-align: right;">0.1722994</td>
<td style="text-align: right;">0.1731798</td>
<td style="text-align: right;">-0.4761360</td>
<td style="text-align: right;">0.0803031</td>
<td style="text-align: right;">1.009113</td>
<td style="text-align: right;">180.23889</td>
<td style="text-align: right;">467.77474</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[7]</td>
<td style="text-align: right;">-0.8057482</td>
<td style="text-align: right;">-0.8067775</td>
<td style="text-align: right;">0.1978722</td>
<td style="text-align: right;">0.1905801</td>
<td style="text-align: right;">-1.1353745</td>
<td style="text-align: right;">-0.4824879</td>
<td style="text-align: right;">1.023032</td>
<td style="text-align: right;">161.69038</td>
<td style="text-align: right;">295.28894</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[8]</td>
<td style="text-align: right;">-0.9204753</td>
<td style="text-align: right;">-0.9206465</td>
<td style="text-align: right;">0.2321990</td>
<td style="text-align: right;">0.2387186</td>
<td style="text-align: right;">-1.3095755</td>
<td style="text-align: right;">-0.5407714</td>
<td style="text-align: right;">1.024508</td>
<td style="text-align: right;">199.77538</td>
<td style="text-align: right;">480.49417</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-32_585dcab31a1e6ded47f1184ce54d1115">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Losgit1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-33_303c563010809ef6c98a0abbb31caa28">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Losgit1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-33-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-34_7402918e9649a63cc9389aed6bb4b0ea">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datalogit)</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_Losgit1<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"ypred"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, <span class="dv">1</span><span class="sc">:</span>n]</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(datalogit<span class="sc">$</span>pobreza), y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Una alternativa es hacer el siguiente modelo que utiliza la función <code>bernoulli_logit</code></p>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-35_ab891fe8389278a369ed83ef609adfd9">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> n;   <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> K;   <span class="sc">/</span><span class="er">/</span> Número de predictores</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>  matrix[n, K] x;   <span class="sc">/</span><span class="er">/</span> Matrix de predictores</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span>,upper<span class="ot">=</span><span class="dv">1</span><span class="sc">&gt;</span> y[n];       <span class="sc">/</span><span class="er">/</span> Vector respuesta</span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  vector[K] beta;       <span class="sc">/</span><span class="er">/</span> coefficients <span class="cf">for</span> predictors</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  real<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> sigma;  <span class="sc">/</span><span class="er">/</span> error scale</span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>transformed parameters {</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>   vector[n] eta;</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>   eta <span class="ot">=</span> x <span class="sc">*</span> beta;</span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">to_vector</span>(beta) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10000</span>);</span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">bernoulli_logit</span>(eta);  <span class="sc">/</span><span class="er">/</span> likelihood</span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>generated quantities {</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>    real ypred[n];                    <span class="sc">/</span><span class="er">/</span> vector de longitud n</span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>    ypred <span class="ot">=</span> <span class="fu">bernoulli_logit_rng</span>(eta);</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-36_a232c2a5b52309b0d8abb7269d5c5657">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>fitLosgit2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/ModeloLogit2.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-37_7fbcb0e2c11444050efb350743d6761a">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>model_Losgit2 <span class="ot">&lt;-</span> fitLosgit2<span class="sc">$</span><span class="fu">sample</span>(<span class="at">data =</span> sample_data, </span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 29.3 seconds.
Chain 2 finished in 29.0 seconds.
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 31.4 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 32.8 seconds.

All 4 chains finished successfully.
Mean chain execution time: 30.6 seconds.
Total execution time: 34.7 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-38_789c97b873ceec7523ae5bae6edd9726">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>model_Losgit2<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta[1]</td>
<td style="text-align: right;">-1.7079176</td>
<td style="text-align: right;">-1.6972150</td>
<td style="text-align: right;">0.4646468</td>
<td style="text-align: right;">0.4993026</td>
<td style="text-align: right;">-2.4188900</td>
<td style="text-align: right;">-0.9568006</td>
<td style="text-align: right;">1.060643</td>
<td style="text-align: right;">50.30893</td>
<td style="text-align: right;">114.41994</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2]</td>
<td style="text-align: right;">0.1903054</td>
<td style="text-align: right;">0.1885245</td>
<td style="text-align: right;">0.1398564</td>
<td style="text-align: right;">0.1355873</td>
<td style="text-align: right;">-0.0379427</td>
<td style="text-align: right;">0.4368236</td>
<td style="text-align: right;">1.007888</td>
<td style="text-align: right;">405.87331</td>
<td style="text-align: right;">682.66399</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[3]</td>
<td style="text-align: right;">0.6664176</td>
<td style="text-align: right;">0.6451645</td>
<td style="text-align: right;">0.4596815</td>
<td style="text-align: right;">0.4688678</td>
<td style="text-align: right;">-0.0561682</td>
<td style="text-align: right;">1.4248350</td>
<td style="text-align: right;">1.057608</td>
<td style="text-align: right;">54.14168</td>
<td style="text-align: right;">116.32892</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[4]</td>
<td style="text-align: right;">0.0170465</td>
<td style="text-align: right;">-0.0083374</td>
<td style="text-align: right;">0.4615456</td>
<td style="text-align: right;">0.4881425</td>
<td style="text-align: right;">-0.7352676</td>
<td style="text-align: right;">0.7625880</td>
<td style="text-align: right;">1.058713</td>
<td style="text-align: right;">51.86891</td>
<td style="text-align: right;">95.52373</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[5]</td>
<td style="text-align: right;">-0.8776590</td>
<td style="text-align: right;">-0.8818775</td>
<td style="text-align: right;">0.4755780</td>
<td style="text-align: right;">0.4926517</td>
<td style="text-align: right;">-1.6322260</td>
<td style="text-align: right;">-0.1075182</td>
<td style="text-align: right;">1.056966</td>
<td style="text-align: right;">52.70390</td>
<td style="text-align: right;">108.30931</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[6]</td>
<td style="text-align: right;">-0.2103947</td>
<td style="text-align: right;">-0.2135240</td>
<td style="text-align: right;">0.1651482</td>
<td style="text-align: right;">0.1623469</td>
<td style="text-align: right;">-0.4890218</td>
<td style="text-align: right;">0.0597638</td>
<td style="text-align: right;">1.007187</td>
<td style="text-align: right;">263.24011</td>
<td style="text-align: right;">475.76958</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[7]</td>
<td style="text-align: right;">-0.8273451</td>
<td style="text-align: right;">-0.8318660</td>
<td style="text-align: right;">0.2004999</td>
<td style="text-align: right;">0.2010361</td>
<td style="text-align: right;">-1.1516455</td>
<td style="text-align: right;">-0.5015037</td>
<td style="text-align: right;">1.008740</td>
<td style="text-align: right;">240.50468</td>
<td style="text-align: right;">606.24781</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[8]</td>
<td style="text-align: right;">-0.9320762</td>
<td style="text-align: right;">-0.9405220</td>
<td style="text-align: right;">0.2347207</td>
<td style="text-align: right;">0.2345280</td>
<td style="text-align: right;">-1.3084650</td>
<td style="text-align: right;">-0.5299981</td>
<td style="text-align: right;">1.007367</td>
<td style="text-align: right;">268.55050</td>
<td style="text-align: right;">349.47199</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-39_3f9252c21ef09aec2a37eb8aa0b20e07">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Losgit2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-40_e59d0c12283e7b9814808ea6ef4b00db">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Losgit2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-41_ec669c7e31890ab18c9f894270f85679">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(datalogit)</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_Losgit2<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"ypred"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, <span class="dv">1</span><span class="sc">:</span>n]</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(datalogit<span class="sc">$</span>pobreza), y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="modelo-binomial" class="level2">
<h2 class="anchored" data-anchor-id="modelo-binomial">Modelo Binomial</h2>
<p>En este caso la variable respuesta representa conteos de éxitos que se tuvieron en un conjunto de distintos experimentos. Se supone que <span class="math inline">\(\mathbf{Y}=\{Y_1, \ldots, Y_n\}\)</span> es un conjunto de variables aleatorias intercambiables cada una con distribución binomial de parámetro <span class="math inline">\(\theta_i\)</span> y <span class="math inline">\(n_i\)</span>. El modelo binomial busca relacionar las probabilidades de éxito <span class="math inline">\(\theta_i\)</span> con variables auxiliares <span class="math inline">\(\mathbf{X}_i\)</span>. Se considera a continuación la función de enlace logística.</p>
<p>La función de vínculo logística dada por <span class="math inline">\(g(\theta_i)=\log\left(\frac{\theta_i}{1-\theta_i}\right)\)</span>, y denotando <span class="math inline">\(\eta_i=\mathbf{X}_i'\boldsymbol{\beta}=g(\theta_i)\)</span>, se tiene que la verosimilitud de los datos está dada por <span class="math display">\[\begin{align}
p(\mathbf{Y}\mid \boldsymbol{\theta})&amp;=\prod_{i=1}^n\binom{n}{y_i}\theta_i^{y_i}(1-\theta_i)^{n-y_i} \notag \\
&amp;=\prod_{i=1}^n\binom{n}{y_i}\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)^{y_i}
\left(1-\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)\right)^{n-y_i}
\end{align}\]</span></p>
<p>Suponga que la distribución a previa para <span class="math inline">\(\boldsymbol{\beta}\)</span> está regida por la siguiente estructura probabilística <span class="math display">\[\begin{equation*}
\boldsymbol{\beta}\sim Normal_q(\mathbf{b},\mathbf{B})
\end{equation*}\]</span></p>
<p>De esta manera, la distribución a posterior toma la siguiente forma. <span class="math display">\[\begin{align*}
p(\boldsymbol{\beta} \mid \mathbf{Y}, \mathbf{X})&amp;\propto
\prod_{i=1}^n\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)^{y_i}
\left(1-\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta})}{1+\exp(\mathbf{X}_i'\boldsymbol{\beta})}\right)\right)^{n-y_i}\\
&amp;\hspace{2cm}\times
\exp\left\{\frac{-1}{2}(\boldsymbol{\beta}-\mathbf{b})'\mathbf{B}^{-1}(\boldsymbol{\beta}-\mathbf{b})\right\}
\end{align*}\]</span></p>
<p>Una vez más, la anterior expresión no tiene una forma cerrada.</p>
<section id="práctica-en-stan-1" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-stan-1">Práctica en <code>STAN</code></h3>
<p>Datos de la encuesta</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-42_4301719e5f6614aecdaf6638de2942bb">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a>dataBino <span class="ot">&lt;-</span> encuesta <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">provincia =</span> <span class="fu">substr</span>(upm, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">pobreza =</span> <span class="fu">ifelse</span>(ingcorte <span class="sc">&lt;</span> lp, <span class="dv">1</span>, <span class="dv">0</span>),</span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(provincia) <span class="sc">%&gt;%</span> </span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>() ,                  <span class="co"># Número de ensayos</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">nPobreza =</span> <span class="fu">sum</span>(pobreza)    <span class="co"># número de exitos </span></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span>                      <span class="co"># covariables  </span></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(tasa_desocupacion, <span class="at">by =</span> <span class="st">"provincia"</span>)</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataBino)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 11%">
<col style="width: 5%">
<col style="width: 10%">
<col style="width: 21%">
<col style="width: 17%">
<col style="width: 16%">
<col style="width: 15%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">provincia</th>
<th style="text-align: right;">n</th>
<th style="text-align: right;">nPobreza</th>
<th style="text-align: right;">tasa_desocupacion</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">2465</td>
<td style="text-align: right;">276</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.3703170</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: right;">252</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">0.0349977</td>
<td style="text-align: right;">2.591579</td>
<td style="text-align: right;">12.73780</td>
<td style="text-align: right;">0.7919954</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03</td>
<td style="text-align: right;">254</td>
<td style="text-align: right;">51</td>
<td style="text-align: right;">0.0324975</td>
<td style="text-align: right;">6.814827</td>
<td style="text-align: right;">17.20451</td>
<td style="text-align: right;">1.0831176</td>
</tr>
<tr class="even">
<td style="text-align: left;">04</td>
<td style="text-align: right;">224</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0.0341694</td>
<td style="text-align: right;">3.430674</td>
<td style="text-align: right;">15.61609</td>
<td style="text-align: right;">0.6434363</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05</td>
<td style="text-align: right;">388</td>
<td style="text-align: right;">57</td>
<td style="text-align: right;">0.0278492</td>
<td style="text-align: right;">4.277717</td>
<td style="text-align: right;">16.72102</td>
<td style="text-align: right;">1.0914497</td>
</tr>
<tr class="even">
<td style="text-align: left;">06</td>
<td style="text-align: right;">402</td>
<td style="text-align: right;">92</td>
<td style="text-align: right;">0.0310001</td>
<td style="text-align: right;">4.062009</td>
<td style="text-align: right;">19.99372</td>
<td style="text-align: right;">0.8190445</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-43_7d55618e27e7c91e8f80be2f78a63ad1">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> D;   <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> K;   <span class="sc">/</span><span class="er">/</span> Número de predictores</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> nd[D];  <span class="sc">/</span><span class="er">/</span> Número de ensayos</span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> yd[D];   <span class="sc">/</span><span class="er">/</span> Número de exitos</span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  matrix[D, K] x;   <span class="sc">/</span><span class="er">/</span> Matrix de predictores</span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>  vector[K] beta;       <span class="sc">/</span><span class="er">/</span> coefficients <span class="cf">for</span> predictors</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a>  real<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">0</span><span class="sc">&gt;</span> sigma;  <span class="sc">/</span><span class="er">/</span> error scale</span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>transformed parameters {</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>   vector[D] eta;</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a>   eta <span class="ot">=</span> x <span class="sc">*</span> beta;</span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>   }</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">to_vector</span>(beta) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">10000</span>);</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>D){</span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>  yd[d] <span class="sc">~</span> <span class="fu">binomial</span>(nd[d], eta[d]);  <span class="sc">/</span><span class="er">/</span> likelihood</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a>generated quantities {</span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>    real ypred[D];                    <span class="sc">/</span><span class="er">/</span> vector de longitud n</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>D){</span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>  ypred[d] <span class="ot">=</span> <span class="fu">binomial_rng</span>(nd[d], eta[d]);  </span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-44_9815782a10995a461ec5964473c92c4c">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>fitBinomial <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/ModeloBinomial.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-45_b3a5c3799685643649344a31736d9af5">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>Xdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(nPobreza <span class="sc">~</span>  </span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>                       Luces_nocturna <span class="sc">+</span> Suelo_cultivo <span class="sc">+</span> Suelo_urbano,</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dataBino)</span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Xdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">(Intercept)</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.3703170</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.591579</td>
<td style="text-align: right;">12.73780</td>
<td style="text-align: right;">0.7919954</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.814827</td>
<td style="text-align: right;">17.20451</td>
<td style="text-align: right;">1.0831176</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.430674</td>
<td style="text-align: right;">15.61609</td>
<td style="text-align: right;">0.6434363</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.277717</td>
<td style="text-align: right;">16.72102</td>
<td style="text-align: right;">1.0914497</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.062009</td>
<td style="text-align: right;">19.99372</td>
<td style="text-align: right;">0.8190445</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-46_5976502c5856fce0c55c137796d5cc13">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">D =</span> <span class="fu">nrow</span>(dataBino),</span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> <span class="fu">ncol</span>(Xdat),</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">x =</span> <span class="fu">as.matrix</span>(Xdat),</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">yd =</span> dataBino<span class="sc">$</span>nPobreza,</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">nd =</span> dataBino<span class="sc">$</span>n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-47_df1b76f07dd78b5b3e7ffbc9ac3c2c45">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>model_Binomial <span class="ot">&lt;-</span> fitBinomial<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">iter_warmup =</span>  <span class="dv">3000</span>,</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> sample_data, </span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 4000 [  0%]  (Warmup) 
Chain 2 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 3 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 1 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 2 Iteration: 3001 / 4000 [ 75%]  (Sampling) 
Chain 3 Iteration: 3001 / 4000 [ 75%]  (Sampling) 
Chain 1 Iteration: 3001 / 4000 [ 75%]  (Sampling) 
Chain 4 Iteration: 2000 / 4000 [ 50%]  (Warmup) 
Chain 2 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 3 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 2 finished in 2.0 seconds.
Chain 3 finished in 1.9 seconds.
Chain 4 Iteration: 3001 / 4000 [ 75%]  (Sampling) 
Chain 4 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 4 finished in 3.0 seconds.
Chain 1 Iteration: 4000 / 4000 [100%]  (Sampling) 
Chain 1 finished in 4.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 2.8 seconds.
Total execution time: 5.4 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-48_7f8d431d09882c5ee1c27efa33e21c6b">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>model_Binomial<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta[1]</td>
<td style="text-align: right;">-0.7802087</td>
<td style="text-align: right;">-0.7791585</td>
<td style="text-align: right;">0.0382514</td>
<td style="text-align: right;">0.0376529</td>
<td style="text-align: right;">-0.8426783</td>
<td style="text-align: right;">-0.7205926</td>
<td style="text-align: right;">1.014075</td>
<td style="text-align: right;">321.7440</td>
<td style="text-align: right;">709.5083</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2]</td>
<td style="text-align: right;">-0.0370912</td>
<td style="text-align: right;">-0.0368038</td>
<td style="text-align: right;">0.0143376</td>
<td style="text-align: right;">0.0151635</td>
<td style="text-align: right;">-0.0610145</td>
<td style="text-align: right;">-0.0139337</td>
<td style="text-align: right;">1.033966</td>
<td style="text-align: right;">214.9504</td>
<td style="text-align: right;">421.6688</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[3]</td>
<td style="text-align: right;">-0.0186637</td>
<td style="text-align: right;">-0.0186427</td>
<td style="text-align: right;">0.0031745</td>
<td style="text-align: right;">0.0032118</td>
<td style="text-align: right;">-0.0239509</td>
<td style="text-align: right;">-0.0133668</td>
<td style="text-align: right;">1.017925</td>
<td style="text-align: right;">392.6122</td>
<td style="text-align: right;">689.3017</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[4]</td>
<td style="text-align: right;">-0.0812237</td>
<td style="text-align: right;">-0.0825642</td>
<td style="text-align: right;">0.0339928</td>
<td style="text-align: right;">0.0353174</td>
<td style="text-align: right;">-0.1350332</td>
<td style="text-align: right;">-0.0246268</td>
<td style="text-align: right;">1.029897</td>
<td style="text-align: right;">236.2776</td>
<td style="text-align: right;">331.7972</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-49_ef3dfbedf462ef40e0e0d014670ef555">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Binomial<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-50_cbbb6f42de4f7f7a2e48dbf3647c0ddd">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Binomial<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-50-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-51_4d1b234675d654adfdde7b9bf80dee20">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dataBino)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_Binomial<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"ypred"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, <span class="dv">1</span><span class="sc">:</span>n]</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> <span class="fu">as.numeric</span>(dataBino<span class="sc">$</span>nPobreza), y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
<section id="regresión-multinomial-con-vínculo-logit" class="level2">
<h2 class="anchored" data-anchor-id="regresión-multinomial-con-vínculo-logit">Regresión multinomial con vínculo logit</h2>
<p>La distribución multinomial es una extensión de la distribución binomial, esta se aplica en situaciones donde hay un número fijo de ensayos independientes, donde cada el resultado de cada ensayo corresponde a una de <span class="math inline">\(K\)</span> categorías.</p>
<p>Generalizando lo anterior, se considera <span class="math inline">\(\mathbf{Y}=\{\mathbf{Y}_1, \ldots, \mathbf{Y}_n\}\)</span> un conjunto de vectores aleatorios intercambiables cada una con distribución multinomial de parámetros <span class="math inline">\((n_i, \boldsymbol{\theta}_i)\)</span>. Note que todos lo vectores tienen <span class="math inline">\(K\)</span> categorias; en particular, el <span class="math inline">\(i\)</span>-ésimo vector del conjunto se define como <span class="math inline">\(\mathbf{Y}_i=(Y_{i1}, \ldots, Y_{iK})'\)</span>, el vector de parámetros de interés es <span class="math inline">\(\boldsymbol{\theta}_i=(\theta_{i1},\ldots, \theta_{iK})\)</span> con <span class="math inline">\(\sum_{k=1}^K\theta_{ik}=1\)</span>, y <span class="math inline">\(n_i=\sum_{k=1}^K Y_{ik}\)</span>, y por ende se tiene que la distribución, condicional a <span class="math inline">\(n_i\)</span>, de <span class="math inline">\(\mathbf{Y}_{i}\)</span> sigue una distribución multinomial tal que: <span class="math display">\[\begin{equation}
p(\mathbf{Y}_{i}\mid n_i, \boldsymbol{\theta}_i)=\binom{n_i}{y_{i1}, \ldots, y_{iK}}\prod_{k=1}^K\theta_{ik}^{y_{ik}}
\end{equation}\]</span></p>
<p>Con base en lo anterior, la verosimilitud de los datos se tiene mediante la siguiente expresión <span class="math display">\[\begin{equation}
p(\mathbf{Y} \mid n, \boldsymbol{\theta})=\prod_{i=1}^n \binom{n_i}{y_{i1}, \ldots, y_{iK}}\prod_{k=1}^K\theta_{ik}^{y_{ik}}
\end{equation}\]</span></p>
<p>Antes de proseguir con el modelamiento bayesiano, es útil notar que en este caso el vínculo no es un vector sino una matriz que responde a una relación lineal entre las covariables y una matriz de coeficientes de regresión, como se puede ver a continuación. <span class="math display">\[\begin{equation*}
\begin{bmatrix}
  \eta_{11} &amp; \eta_{12} &amp; \cdots &amp; \eta_{1K} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  \eta_{n1} &amp; \eta_{n2} &amp; \cdots &amp; \eta_{nK}
\end{bmatrix}
=
\begin{bmatrix}
  X_{11} &amp; X_{12} &amp; \cdots &amp; X_{1q} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  X_{n1} &amp; X_{n2} &amp; \cdots &amp; X_{nq}
\end{bmatrix}
\begin{bmatrix}
  \beta_{11} &amp; \beta_{12} &amp; \cdots &amp; \beta_{1K} \\
  \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
  \beta_{q1} &amp; \beta_{q2} &amp; \cdots &amp; \beta_{qK}
\end{bmatrix}
\end{equation*}\]</span></p>
<p>Es decir, <span class="math display">\[\begin{equation}
\boldsymbol{\eta}=\mathbf{X}'\boldsymbol{\beta}
\end{equation}\]</span></p>
<p>Lo anterior conlleva a que <span class="math inline">\(\eta_{ik}=\mathbf{X}_i'\boldsymbol{\beta}_k\)</span>, donde <span class="math inline">\(\mathbf{X}_i\)</span> es la <span class="math inline">\(i\)</span>-ésima fila de la matriz <span class="math inline">\(\mathbf{X}\)</span> y <span class="math inline">\(\boldsymbol{\beta}_k\)</span> es la <span class="math inline">\(k\)</span>-ésima columna de la matriz <span class="math inline">\(\boldsymbol{\beta}\)</span>. Ahora, tomando como línea de base la primera columnna de la matriz <span class="math inline">\(\boldsymbol{\eta}\)</span> (es decir, el vector de las probabilidades de la categoría 1 para los <span class="math inline">\(n\)</span> individuos), y utilizando la función de vinculo logístico, se tiene que para los elementos en las restantes columnnas de <span class="math inline">\(\boldsymbol{\eta}\)</span>, <span class="math display">\[\begin{equation}
\eta_{ik}=g(\theta_{ik})=\log\left(\frac{\theta_{ik}}{\theta_{i1}}\right)=\log\left(\frac{\theta_{ik}}{\theta_{i1}}\right)
\end{equation}\]</span></p>
<p>Con un poco de álgebra se comprueba que la función inversa para <span class="math inline">\(g(\cdot)\)</span> está dada por la siguiente expresión <span class="math display">\[\begin{equation}
\theta_{ik}=g^{-1}(\eta_{ik})=\theta_{i1}\exp(\eta_{ik}) \ \ \ \ \ \forall k=2,\ldots,K
\end{equation}\]</span></p>
<p>Ahora, para la primera columna de <span class="math inline">\(\boldsymbol{\eta}\)</span>, es decir, el vector de probabilidades de la primera categoría, se tiene que <span class="math display">\[\begin{equation*}
\theta_{i1}=1-\sum_{j=2}^K\theta_{ij}=1-\sum_{j=2}^K\theta_{i1}\exp(\eta_{ij})
\end{equation*}\]</span></p>
<p>de donde se tiene que <span class="math display">\[\begin{equation}
\theta_{i1}=\frac{1}{1+\sum_{j=2}^K\exp(\eta_{ij})}
\end{equation}\]</span></p>
<p>Finalmente, se tiene que <span class="math display">\[\begin{equation*}
\theta_{ik}=\frac{\exp(\eta_{ik})}{1+\sum_{k=2}^K\exp(\eta_{ik})} \ \ \ \ \forall k=1,\ldots,K
\end{equation*}\]</span></p>
<p>con <span class="math inline">\(\boldsymbol{\beta}_1=0\)</span>, esto es <span class="math inline">\(\eta_{i1}=0\)</span> para todo <span class="math inline">\(i\)</span>. Notando que <span class="math inline">\(\eta_{ik}=\mathbf{X}_i'\boldsymbol{\beta}_k\)</span>, se tiene que la verosimilitud de los datos toma la siguiente forma</p>
<span class="math display">\[\begin{align*}
p(\mathbf{Y} \mid n, \boldsymbol{\theta})=&amp;\prod_{i=1}^n \binom{n_i}{y_{i1}, \ldots, y_{iK}}\prod_{k=1}^K\theta_{ik}^{y_{ik}}\\
p(\mathbf{Y} \mid n, \boldsymbol{\beta})=&amp;\prod_{i=1}^n \binom{n_i}{y_{i1}, \ldots, y_{iK}}
\prod_{k=1}^K\left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta}_k)}{1+\sum_{k=2}^K\exp(\mathbf{X}_i'\boldsymbol{\beta}_k)}\right)^{y_{ik}}\\
\end{align*}\]</span>
<p>Suponiendo que la distribución a priori para <span class="math inline">\(\boldsymbol{\beta}_k\)</span> está regida por la siguiente estructura probabilística <span class="math display">\[\begin{equation*}
\boldsymbol{\beta}_k\sim Normal_q(\mathbf{b}_k,\mathbf{B}_k)
\end{equation*}\]</span></p>
<p>De esta manera, la distribución a posteriori para el <span class="math inline">\(k\)</span> ésimo vector <span class="math inline">\(\boldsymbol{\beta}_k\)</span> toma la siguiente forma. <span class="math display">\[\begin{align*}
p(\boldsymbol{\beta}_k \mid \mathbf{Y}, \mathbf{X}, n)&amp;\propto
\prod_{i=1}^n \left(\frac{\exp(\mathbf{X}_i'\boldsymbol{\beta}_k)}{1+\sum_{k=2}^K\exp(\mathbf{X}_i'\boldsymbol{\beta}_k)}\right)^{y_{ik}}\\
&amp;\hspace{2cm}\times
\exp\left\{-\frac{1}{2}(\boldsymbol{\beta}-\mathbf{b})'\mathbf{B}^{-1}(\boldsymbol{\beta}-\mathbf{b})\right\}
\end{align*}\]</span></p>
<p>Una vez más, la anterior expresión no tiene una forma cerrada.</p>
<section id="práctica-en-stan-2" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-stan-2">Práctica en <code>STAN</code></h3>
<p>Datos de la encuesta</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-52_ced7f7f19bcb78378c84815bdfffa12e">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>dataMultinomial <span class="ot">&lt;-</span> encuesta <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(edad <span class="sc">&gt;=</span> <span class="dv">18</span>, condact3 <span class="sc">%in%</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">provincia =</span> <span class="fu">substr</span>(upm, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">empleo =</span> <span class="fu">as_factor</span>(condact3),</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(provincia, empleo) <span class="sc">%&gt;%</span> </span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>   <span class="fu">tally</span>() <span class="sc">%&gt;%</span> <span class="fu">data.frame</span>()</span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>dataMultinomial <span class="ot">&lt;-</span> dataMultinomial <span class="sc">%&gt;%</span></span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(<span class="at">key =</span> <span class="st">"empleo"</span>,<span class="at">value =</span> <span class="st">"n"</span>, <span class="at">fill =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a> <span class="fu">full_join</span>(tasa_desocupacion, <span class="at">by =</span> <span class="st">"provincia"</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataMultinomial)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 18%">
<col style="width: 15%">
<col style="width: 14%">
<col style="width: 13%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">provincia</th>
<th style="text-align: right;">Ocupado</th>
<th style="text-align: right;">Desocupado</th>
<th style="text-align: right;">Inactivo</th>
<th style="text-align: right;">tasa_desocupacion</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: right;">1481</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">899</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.3703170</td>
</tr>
<tr class="even">
<td style="text-align: left;">02</td>
<td style="text-align: right;">205</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47</td>
<td style="text-align: right;">0.0349977</td>
<td style="text-align: right;">2.591579</td>
<td style="text-align: right;">12.73780</td>
<td style="text-align: right;">0.7919954</td>
</tr>
<tr class="odd">
<td style="text-align: left;">03</td>
<td style="text-align: right;">166</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">81</td>
<td style="text-align: right;">0.0324975</td>
<td style="text-align: right;">6.814827</td>
<td style="text-align: right;">17.20451</td>
<td style="text-align: right;">1.0831176</td>
</tr>
<tr class="even">
<td style="text-align: left;">04</td>
<td style="text-align: right;">132</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">0.0341694</td>
<td style="text-align: right;">3.430674</td>
<td style="text-align: right;">15.61609</td>
<td style="text-align: right;">0.6434363</td>
</tr>
<tr class="odd">
<td style="text-align: left;">05</td>
<td style="text-align: right;">309</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">70</td>
<td style="text-align: right;">0.0278492</td>
<td style="text-align: right;">4.277717</td>
<td style="text-align: right;">16.72102</td>
<td style="text-align: right;">1.0914497</td>
</tr>
<tr class="even">
<td style="text-align: left;">06</td>
<td style="text-align: right;">324</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">69</td>
<td style="text-align: right;">0.0310001</td>
<td style="text-align: right;">4.062009</td>
<td style="text-align: right;">19.99372</td>
<td style="text-align: right;">0.8190445</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-53_ff4a8b5f4377ab9d4580ca10f81f5e7b">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">1</span><span class="sc">&gt;</span> D;    <span class="sc">/</span><span class="er">/</span> número de postestrto </span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">1</span><span class="sc">&gt;</span> P;    <span class="sc">/</span><span class="er">/</span> categorías</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  int<span class="sc">&lt;</span>lower<span class="ot">=</span><span class="dv">1</span><span class="sc">&gt;</span> K;  <span class="sc">/</span><span class="er">/</span> cantidad de regresores</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  int y[D, P];       <span class="sc">/</span><span class="er">/</span> matriz de datos</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  matrix[D, K] X; <span class="sc">/</span><span class="er">/</span> matriz de covariables</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>  matrix[P<span class="dv">-1</span>, K] beta;<span class="sc">/</span><span class="er">/</span> matriz de parámetros </span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>                 </span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>transformed parameters {</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>  simplex[P] theta[D];<span class="sc">/</span><span class="er">/</span> vector de parámetros;</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>  real num[D, P];</span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>  real den[D];</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>D){</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>    num[d, <span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span>;</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>    num[d, <span class="dv">2</span>] <span class="ot">=</span> <span class="fu">exp</span>(X[d, ] <span class="sc">*</span> beta[<span class="dv">1</span>, ]<span class="st">') ;</span></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a><span class="st">    num[d, 3] = exp(X[d, ] * beta[2, ]'</span>) ;</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    den[d] <span class="ot">=</span> <span class="fu">sum</span>(num[d, ]);</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>D){</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(p <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span>P){</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    theta[d, p] <span class="ot">=</span> num[d, p]<span class="sc">/</span>den[d];</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>    theta[d, <span class="dv">1</span>] <span class="ot">=</span> <span class="dv">1</span><span class="sc">/</span>den[d];</span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">to_vector</span>(beta) <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>, <span class="dv">100</span>);</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(d <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>D){</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>    target <span class="sc">+</span><span class="er">=</span> <span class="fu">multinomial_lpmf</span>(y[d, ] <span class="sc">|</span> theta[d, ]); </span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-54_76c8a87c559fb8d393629150eb31c0ae">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>fitMultinomial <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/ModeloMultinomial.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-55_79ac6850f589e69eff89680ec8dd0ca3">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>Xdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(Ocupado <span class="sc">~</span>  </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                       Luces_nocturna <span class="sc">+</span> Suelo_cultivo <span class="sc">+</span> Suelo_urbano,</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dataMultinomial)</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Xdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">(Intercept)</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.3703170</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">2.591579</td>
<td style="text-align: right;">12.73780</td>
<td style="text-align: right;">0.7919954</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">6.814827</td>
<td style="text-align: right;">17.20451</td>
<td style="text-align: right;">1.0831176</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">3.430674</td>
<td style="text-align: right;">15.61609</td>
<td style="text-align: right;">0.6434363</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.277717</td>
<td style="text-align: right;">16.72102</td>
<td style="text-align: right;">1.0914497</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">4.062009</td>
<td style="text-align: right;">19.99372</td>
<td style="text-align: right;">0.8190445</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-56_fe0dcbc261c2f2352b24b0b8fda361be">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>ydat <span class="ot">&lt;-</span> dataMultinomial <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Ocupado<span class="sc">:</span>Inactivo) <span class="sc">%&gt;%</span> </span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as.matrix</span>()</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ydat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<thead>
<tr class="header">
<th style="text-align: right;">Ocupado</th>
<th style="text-align: right;">Desocupado</th>
<th style="text-align: right;">Inactivo</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1481</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">899</td>
</tr>
<tr class="even">
<td style="text-align: right;">205</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">47</td>
</tr>
<tr class="odd">
<td style="text-align: right;">166</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">81</td>
</tr>
<tr class="even">
<td style="text-align: right;">132</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">83</td>
</tr>
<tr class="odd">
<td style="text-align: right;">309</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">70</td>
</tr>
<tr class="even">
<td style="text-align: right;">324</td>
<td style="text-align: right;">9</td>
<td style="text-align: right;">69</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-57_434ad1f66675cd5e5f9023100a5edb25">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">D =</span> <span class="fu">nrow</span>(dataMultinomial),</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">K =</span> <span class="fu">ncol</span>(Xdat),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X =</span> <span class="fu">as.matrix</span>(Xdat),</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">P =</span> <span class="fu">ncol</span>(ydat),</span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> ydat</span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-58_8beb1a270b28123740cb39d1a0882b04">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>model_Multinomial <span class="ot">&lt;-</span> fitMultinomial<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> sample_data, </span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">iter_sampling =</span> <span class="dv">2000</span>,</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">2000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 3000 [  0%]  (Warmup) 
Chain 3 Iteration: 1001 / 3000 [ 33%]  (Sampling) 
Chain 1 Iteration: 1001 / 3000 [ 33%]  (Sampling) 
Chain 2 Iteration: 1001 / 3000 [ 33%]  (Sampling) 
Chain 4 Iteration: 1001 / 3000 [ 33%]  (Sampling) 
Chain 1 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 1 finished in 21.0 seconds.
Chain 3 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 3 finished in 21.6 seconds.
Chain 4 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 4 finished in 21.4 seconds.
Chain 2 Iteration: 3000 / 3000 [100%]  (Sampling) 
Chain 2 finished in 22.0 seconds.

All 4 chains finished successfully.
Mean chain execution time: 21.5 seconds.
Total execution time: 23.0 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-59_52b4e499a0688dc02889182d1a15862f">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>model_Multinomial<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta[1,1]</td>
<td style="text-align: right;">-3.2772912</td>
<td style="text-align: right;">-3.2772050</td>
<td style="text-align: right;">0.1067659</td>
<td style="text-align: right;">0.1064877</td>
<td style="text-align: right;">-3.4529265</td>
<td style="text-align: right;">-3.1033145</td>
<td style="text-align: right;">1.000649</td>
<td style="text-align: right;">4998.607</td>
<td style="text-align: right;">5441.903</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2,1]</td>
<td style="text-align: right;">-1.0022932</td>
<td style="text-align: right;">-1.0029000</td>
<td style="text-align: right;">0.0398568</td>
<td style="text-align: right;">0.0407189</td>
<td style="text-align: right;">-1.0667635</td>
<td style="text-align: right;">-0.9374120</td>
<td style="text-align: right;">1.000513</td>
<td style="text-align: right;">5053.945</td>
<td style="text-align: right;">5358.511</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[1,2]</td>
<td style="text-align: right;">0.1937729</td>
<td style="text-align: right;">0.1937880</td>
<td style="text-align: right;">0.0347453</td>
<td style="text-align: right;">0.0346358</td>
<td style="text-align: right;">0.1370106</td>
<td style="text-align: right;">0.2511847</td>
<td style="text-align: right;">1.001536</td>
<td style="text-align: right;">3105.062</td>
<td style="text-align: right;">4017.048</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2,2]</td>
<td style="text-align: right;">0.0448057</td>
<td style="text-align: right;">0.0449378</td>
<td style="text-align: right;">0.0131479</td>
<td style="text-align: right;">0.0130178</td>
<td style="text-align: right;">0.0230839</td>
<td style="text-align: right;">0.0662900</td>
<td style="text-align: right;">1.000500</td>
<td style="text-align: right;">3110.574</td>
<td style="text-align: right;">3921.692</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[1,3]</td>
<td style="text-align: right;">-0.0794194</td>
<td style="text-align: right;">-0.0793398</td>
<td style="text-align: right;">0.0089837</td>
<td style="text-align: right;">0.0088806</td>
<td style="text-align: right;">-0.0944740</td>
<td style="text-align: right;">-0.0646392</td>
<td style="text-align: right;">1.000760</td>
<td style="text-align: right;">5241.818</td>
<td style="text-align: right;">5617.679</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2,3]</td>
<td style="text-align: right;">-0.0040704</td>
<td style="text-align: right;">-0.0040371</td>
<td style="text-align: right;">0.0028744</td>
<td style="text-align: right;">0.0029079</td>
<td style="text-align: right;">-0.0088153</td>
<td style="text-align: right;">0.0006192</td>
<td style="text-align: right;">1.000113</td>
<td style="text-align: right;">7342.445</td>
<td style="text-align: right;">5975.960</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[1,4]</td>
<td style="text-align: right;">-0.0149158</td>
<td style="text-align: right;">-0.0147389</td>
<td style="text-align: right;">0.0656067</td>
<td style="text-align: right;">0.0662447</td>
<td style="text-align: right;">-0.1227222</td>
<td style="text-align: right;">0.0925209</td>
<td style="text-align: right;">1.001066</td>
<td style="text-align: right;">3778.851</td>
<td style="text-align: right;">5139.169</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2,4]</td>
<td style="text-align: right;">0.0063639</td>
<td style="text-align: right;">0.0066327</td>
<td style="text-align: right;">0.0289182</td>
<td style="text-align: right;">0.0283847</td>
<td style="text-align: right;">-0.0413636</td>
<td style="text-align: right;">0.0535260</td>
<td style="text-align: right;">1.000211</td>
<td style="text-align: right;">3408.329</td>
<td style="text-align: right;">4540.201</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-60_5c33b011219fbbbfafab7e9b5850d9c6">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Multinomial<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-60-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-61_a8f67ede4122eea820df80c3bce0a42a">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Multinomial<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-62_159e382372926177daddaf6e25537202">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dataMultinomial)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_Multinomial<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"theta"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> ydat[,<span class="st">"Ocupado"</span>]<span class="sc">/</span><span class="fu">rowSums</span>(ydat), </span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>                 y_pred2[,<span class="dv">1</span><span class="sc">:</span>n]) <span class="sc">/</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> ydat[,<span class="st">"Desocupado"</span>]<span class="sc">/</span><span class="fu">rowSums</span>(ydat), </span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>                 <span class="at">yrep =</span> y_pred2[,(n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">2</span><span class="sc">*</span>n)]) <span class="sc">/</span></span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> ydat[,<span class="st">"Inactivo"</span>]<span class="sc">/</span><span class="fu">rowSums</span>(ydat), </span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>                 y_pred2[,(<span class="dv">2</span><span class="sc">*</span>n<span class="sc">+</span><span class="dv">1</span>)<span class="sc">:</span>(<span class="dv">3</span><span class="sc">*</span>n)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-62-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>
<section id="modelos-lineales-mixtos-y-multinivel" class="level1">
<h1>Modelos lineales mixtos y multinivel</h1>
<p>Aunque es posible proponer modelos que contemplen demasiadas etapas, no es realista ajustar modelos con más de tres niveles. Una formulación general para un modelo con dos niveles es la siguiente</p>
<span class="math display">\[\begin{align*}
\mathbf{Y} \mid \mathbf{X}_1,\boldsymbol{\beta}_1,\boldsymbol{\Sigma}_{\mathbf{Y}}
&amp;\sim Normal_n(\mathbf{X}_1\boldsymbol{\beta}_1,\boldsymbol{\Sigma}_{\mathbf{Y}} )\\
\boldsymbol{\beta}_1 \mid \mathbf{X}_2,\boldsymbol{\beta}_2,\boldsymbol{\Sigma}_{\boldsymbol{\beta}_1}
&amp;\sim Normal_q(\mathbf{X}_2\boldsymbol{\beta}_2,\boldsymbol{\Sigma}_{\boldsymbol{\beta}_1})\\
\boldsymbol{\beta}_2 \mid \mathbf{b},\mathbf{B}&amp;\sim Normal_r(\mathbf{b},\mathbf{B})
\end{align*}\]</span>
<p>donde <span class="math inline">\(\mathbf{b},\mathbf{B}\)</span> son hiperparámetros conocidos. Nótese que el orden de la verosimilitud de las observaciones es <span class="math inline">\(n\)</span>, el tamaño de la muestra, mientras que el orden de la distribución previa para el parámetro <span class="math inline">\(\boldsymbol{\beta}_1\)</span> es <span class="math inline">\(q\)</span>, el número de variables de información auxiliar para el primer nivel, y por último el orden de la distribución previa para el hiperparámetro <span class="math inline">\(\boldsymbol{\beta}_2\)</span> es <span class="math inline">\(r\)</span>, el número de variables de información auxiliar para el segundo nivel.</p>
<section id="intercepto-aleatorio" class="level2">
<h2 class="anchored" data-anchor-id="intercepto-aleatorio">Intercepto aleatorio</h2>
<p>Suponga que tenemos una población con estructura multinivel en el intercepto dado por la siguiente expresión:</p>
<span class="math display">\[\begin{align}
y_{ij} &amp;= \alpha_j + \beta X_{ij} + \epsilon_{ij} \label{InterAlea1}\\
\alpha_j &amp;= \gamma_0 + \gamma_1 U_{j}+e_{j}\label{InterAlea2}
\end{align}\]</span>
<p>donde <span class="math inline">\(Var(\epsilon_{ij})=\sigma^2_y\)</span> y <span class="math inline">\(Var(e_{j})=\sigma^2_{\alpha}\)</span> para <span class="math inline">\(i=1,\ldots,n_j\)</span> y <span class="math inline">\(j=1,\ldots,J\)</span>, <span class="math inline">\(X_{ij}\)</span> es una característica de información auxiliar a nivel del individuo y <span class="math inline">\(U_j\)</span> es una característica de información auxiliar a nivel de bloque o estructura conteniendo al individuo.</p>
<p>El anterior planteamiento también se puede escribir como: <span class="math display">\[\begin{align*}
y_{ij} &amp;\sim Normal (\alpha_j + \beta X_{ij}, \sigma^2_y )\\
\alpha_j &amp;\sim Normal (\gamma_0 + \gamma_1 U_{j}, \sigma^2_{\alpha})
\end{align*}\]</span></p>
<p>Para hallar la forma de estimar los coeficientes <span class="math inline">\(\beta\)</span>, <span class="math inline">\(\gamma_0\)</span> y <span class="math inline">\(\gamma_1\)</span>, Nótese que <span class="math inline">\(y_{ij} = \gamma_0 + \gamma_1 U_{j} + \beta X_{ij} + \epsilon_{ij}+e_{j}\)</span>, que a la vez es equivalente a <span class="math display">\[\begin{align}
y^{(1)}_{ij} &amp;=\beta X_{ij} + v_{ij}\label{InterAlea3}\\
y^{(2)}_{ij} &amp;= \gamma_0 + \gamma_1 U_{j} + v_{ij}\label{InterAlea4}
\end{align}\]</span></p>
<p>donde <span class="math inline">\(y^{(1)}_{ij}=y_{ij} - \gamma_0 - \gamma_1 U_{j}\)</span>, <span class="math inline">\(y^{(2)}_{ij}=y_{ij}-\beta X_{ij}\)</span> y <span class="math inline">\(v_{ij}=\epsilon_{ij}+e_{j}\)</span>. Las distribuciones previas de <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\boldsymbol{\gamma}=(\gamma_0,\gamma_1)'\)</span> por <span class="math inline">\(\beta\sim Normal(\mu,\tau^2)\)</span> y <span class="math inline">\(\boldsymbol{\gamma}\sim Normal(\boldsymbol{\gamma}_0,\boldsymbol{\Gamma}_0)\)</span>, se tiene las siguientes distribuciones condicionales de <span class="math inline">\(\beta\)</span> y <span class="math inline">\(\boldsymbol{\gamma}\)</span></p>
<p><span class="math display">\[\begin{align*}
\beta\mid \boldsymbol{\gamma}, \mathbf{y},\mathbf{X},\mathbf{U}&amp;\sim Normal(\mu_n,\tau^2_n)\\
\boldsymbol{\gamma}\mid \beta,\mathbf{y},\mathbf{X},\mathbf{U}&amp;\sim Normal(\boldsymbol{\gamma}_n,\boldsymbol{\Gamma}_n)
\end{align*}\]</span></p>
<p>con <span class="math inline">\(\tau^2_n=(1/\tau^2+\sum_{i}x_i^2/(\sigma^2_y+\sigma^2_\alpha))^{-1}\)</span>, <span class="math inline">\(\mu_n=\tau^2_n(\mu/\tau^2+\sum x_{ij}y_{ij}^{(1)}/(\sigma^2_y+\sigma^2_\alpha))\)</span>, <span class="math inline">\(\boldsymbol{\Gamma}_n=(\boldsymbol{\Gamma}_0^{-1}+\mathbf{U}'\boldsymbol{\Sigma}_v^{-1}\mathbf{U})^{-1}\)</span> y <span class="math inline">\(\boldsymbol{\gamma}_n=\boldsymbol{\Gamma}_n(\boldsymbol{\Gamma}_0^{-1}\boldsymbol{\gamma}_0+\mathbf{U}'\boldsymbol{\Sigma}_v^{-1}\mathbf{y}^{(2)})\)</span>. <span class="math inline">\(\mathbf{U}\)</span> es la matriz de dimensión <span class="math inline">\(n\times 2\)</span> que contiene la columna de unos y los datos de <span class="math inline">\(U_j\)</span>, <span class="math inline">\(\mathbf{y}^{(2)}\)</span> es el vector que contiene los datos de <span class="math inline">\(y_{ij}^{(2)}\)</span> y <span class="math inline">\(\boldsymbol{\Sigma}_v=(\sigma^2_y+\sigma^2_\alpha)\mathbf{I}_n\)</span>.</p>
<section id="práctica-en-stan-3" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-stan-3">Práctica en <code>STAN</code></h3>
<p>Datos de la encuesta</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-63_f59dc01f9b7d4b8fc5d6255c6c9bbcba">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>dataMultinivel <span class="ot">&lt;-</span> encuesta <span class="sc">%&gt;%</span> </span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">transmute</span>(</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">provincia =</span> <span class="fu">substr</span>(upm, <span class="dv">1</span>, <span class="dv">2</span>),</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">ingreo =</span> ingcorte<span class="sc">+</span><span class="dv">1</span>,</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>   <span class="at">sexo =</span> <span class="fu">as_factor</span>(sexo),  </span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">anoest =</span> <span class="fu">case_when</span>(</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">5</span> <span class="sc">|</span> <span class="fu">is.na</span>(anoest)   <span class="sc">~</span> <span class="st">"98"</span>  , <span class="co">#No aplica</span></span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">==</span> <span class="dv">99</span> <span class="sc">~</span> <span class="st">"99"</span>, <span class="co">#NS/NR</span></span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">==</span> <span class="dv">0</span>  <span class="sc">~</span> <span class="st">"1"</span>, <span class="co"># Sin educacion</span></span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>) <span class="sc">~</span> <span class="st">"2"</span>,       <span class="co"># 1 - 6</span></span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">~</span> <span class="st">"3"</span>,      <span class="co"># 7 - 12</span></span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>    anoest <span class="sc">&gt;</span> <span class="dv">12</span> <span class="sc">~</span> <span class="st">"4"</span>,      <span class="co"># mas de 12</span></span>
<span id="cb70-13"><a href="#cb70-13" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Error"</span>  ),</span>
<span id="cb70-14"><a href="#cb70-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb70-15"><a href="#cb70-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">edad =</span> <span class="fu">case_when</span>(</span>
<span id="cb70-16"><a href="#cb70-16" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">15</span> <span class="sc">~</span> <span class="st">"1"</span>,</span>
<span id="cb70-17"><a href="#cb70-17" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="st">"2"</span>,</span>
<span id="cb70-18"><a href="#cb70-18" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">45</span> <span class="sc">~</span> <span class="st">"3"</span>,</span>
<span id="cb70-19"><a href="#cb70-19" aria-hidden="true" tabindex="-1"></a>    edad <span class="sc">&lt;</span> <span class="dv">65</span> <span class="sc">~</span> <span class="st">"4"</span>,</span>
<span id="cb70-20"><a href="#cb70-20" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"5"</span>),</span>
<span id="cb70-21"><a href="#cb70-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(provincia, anoest, edad, sexo) <span class="sc">%&gt;%</span> </span>
<span id="cb70-22"><a href="#cb70-22" aria-hidden="true" tabindex="-1"></a><span class="fu">summarise</span>(<span class="at">prom_Ingreso =</span> <span class="fu">mean</span>(ingreo), <span class="at">.groups =</span> <span class="st">"drop"</span>)</span>
<span id="cb70-23"><a href="#cb70-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-24"><a href="#cb70-24" aria-hidden="true" tabindex="-1"></a>dataMultinivel <span class="ot">&lt;-</span> dataMultinivel <span class="sc">%&gt;%</span> </span>
<span id="cb70-25"><a href="#cb70-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(tasa_desocupacion, <span class="at">by =</span> <span class="st">"provincia"</span>)</span>
<span id="cb70-26"><a href="#cb70-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-27"><a href="#cb70-27" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dataMultinivel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 6%">
<col style="width: 12%">
<col style="width: 17%">
<col style="width: 14%">
<col style="width: 13%">
<col style="width: 12%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">provincia</th>
<th style="text-align: left;">anoest</th>
<th style="text-align: left;">edad</th>
<th style="text-align: left;">sexo</th>
<th style="text-align: right;">prom_Ingreso</th>
<th style="text-align: right;">tasa_desocupacion</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Hombre</td>
<td style="text-align: right;">245.0800</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="even">
<td style="text-align: left;">01</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">2</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: right;">1394.6667</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Hombre</td>
<td style="text-align: right;">158.8025</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="even">
<td style="text-align: left;">01</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">3</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: right;">195.0307</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="odd">
<td style="text-align: left;">01</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Hombre</td>
<td style="text-align: right;">306.1000</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="even">
<td style="text-align: left;">01</td>
<td style="text-align: left;">1</td>
<td style="text-align: left;">4</td>
<td style="text-align: left;">Mujer</td>
<td style="text-align: right;">172.5559</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
</tbody>
</table>
</div>
</div>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-64_894496cc785a38ca3d8cd50866b190a3">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  int <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span>N;                       <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  int <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span>k;                       <span class="sc">/</span><span class="er">/</span> Número de covariables </span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a>  int  Nv1;                               <span class="sc">/</span><span class="er">/</span> Número de grupos</span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  int  Grupo[N];                         <span class="sc">/</span><span class="er">/</span> Ids de grupos</span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>  vector[N] y;                          <span class="sc">/</span><span class="er">/</span> Variables respuesta</span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>  matrix [N,k] X;                        <span class="sc">/</span><span class="er">/</span> Variables regresoras</span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>  vector[Nv1] beta0;       <span class="sc">/</span><span class="er">/</span> coeficientes del modelo</span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>  vector[k] beta1;         <span class="sc">/</span><span class="er">/</span> coeficientes del modelo</span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  real <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span> sigma;</span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>transformed parameters{</span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a> vector[N] mu;</span>
<span id="cb71-18"><a href="#cb71-18" aria-hidden="true" tabindex="-1"></a> mu <span class="ot">=</span>  beta0[Grupo] <span class="sc">+</span> X<span class="sc">*</span>beta1;</span>
<span id="cb71-19"><a href="#cb71-19" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb71-20"><a href="#cb71-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-21"><a href="#cb71-21" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb71-22"><a href="#cb71-22" aria-hidden="true" tabindex="-1"></a>  beta0 <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span>);</span>
<span id="cb71-23"><a href="#cb71-23" aria-hidden="true" tabindex="-1"></a>  beta1 <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span>);</span>
<span id="cb71-24"><a href="#cb71-24" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">cauchy</span>(<span class="dv">0</span>,<span class="dv">100</span>);</span>
<span id="cb71-25"><a href="#cb71-25" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">normal</span>(mu , sigma);</span>
<span id="cb71-26"><a href="#cb71-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb71-27"><a href="#cb71-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-65_f5fcd123d8eba2feaf77583cdc23a7c8">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a>fitMultinivel1 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/Multinivel_Intercepto1.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-66_fe47c97340a452db39e6f64e33ee9755">
<div class="sourceCode cell-code" id="cb73"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>Xdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(prom_Ingreso <span class="sc">~</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">+</span> sexo <span class="sc">+</span> anoest <span class="sc">+</span> edad <span class="sc">+</span> tasa_desocupacion <span class="sc">+</span> Luces_nocturna <span class="sc">+</span> Suelo_cultivo <span class="sc">+</span> Suelo_urbano,</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dataMultinivel)</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Xdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 6%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 14%">
<col style="width: 12%">
<col style="width: 11%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">sexoHombre</th>
<th style="text-align: right;">sexoMujer</th>
<th style="text-align: right;">anoest2</th>
<th style="text-align: right;">anoest3</th>
<th style="text-align: right;">anoest4</th>
<th style="text-align: right;">edad3</th>
<th style="text-align: right;">edad4</th>
<th style="text-align: right;">edad5</th>
<th style="text-align: right;">tasa_desocupacion</th>
<th style="text-align: right;">Luces_nocturna</th>
<th style="text-align: right;">Suelo_cultivo</th>
<th style="text-align: right;">Suelo_urbano</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
<tr class="even">
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.0302004</td>
<td style="text-align: right;">6.355676</td>
<td style="text-align: right;">10.99138</td>
<td style="text-align: right;">1.370317</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-67_aff3de6bdd9a034946258e556b404e00">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(dataMultinivel),</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">k =</span> <span class="fu">ncol</span>(Xdat),</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X =</span> <span class="fu">as.matrix</span>(Xdat),</span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Nv1 =</span> <span class="fu">length</span>(<span class="fu">unique</span>(dataMultinivel<span class="sc">$</span>provincia)),</span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Grupo =</span> <span class="fu">as.numeric</span>(<span class="fu">as_factor</span>(dataMultinivel<span class="sc">$</span>provincia)),</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> dataMultinivel<span class="sc">$</span>prom_Ingreso</span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-68_6e946810f4fcb69d055415dd2730e60e">
<div class="sourceCode cell-code" id="cb75"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel1 <span class="ot">&lt;-</span> fitMultinivel1<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> sample_data, </span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 21.7 seconds.
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 22.1 seconds.
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 22.0 seconds.
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 22.1 seconds.

All 4 chains finished successfully.
Mean chain execution time: 22.0 seconds.
Total execution time: 23.8 seconds.</code></pre>
</div>
</div>
<p>La estimación del parámetro <span class="math inline">\(B\)</span> es:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-69_51d4e50f91e002310b06eb691d3adc4d">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel1<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta0"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta0[1]</td>
<td style="text-align: right;">96.9325315</td>
<td style="text-align: right;">96.744250</td>
<td style="text-align: right;">40.58744</td>
<td style="text-align: right;">40.17512</td>
<td style="text-align: right;">30.45914</td>
<td style="text-align: right;">162.897200</td>
<td style="text-align: right;">1.0028170</td>
<td style="text-align: right;">1005.6610</td>
<td style="text-align: right;">1473.097</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[2]</td>
<td style="text-align: right;">-43.0943308</td>
<td style="text-align: right;">-43.263400</td>
<td style="text-align: right;">42.62201</td>
<td style="text-align: right;">42.63046</td>
<td style="text-align: right;">-113.32655</td>
<td style="text-align: right;">29.542085</td>
<td style="text-align: right;">1.0037492</td>
<td style="text-align: right;">1087.1577</td>
<td style="text-align: right;">1969.091</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[3]</td>
<td style="text-align: right;">2.2017747</td>
<td style="text-align: right;">1.884250</td>
<td style="text-align: right;">48.83133</td>
<td style="text-align: right;">49.53997</td>
<td style="text-align: right;">-76.77733</td>
<td style="text-align: right;">82.769410</td>
<td style="text-align: right;">1.0057260</td>
<td style="text-align: right;">1107.5558</td>
<td style="text-align: right;">2036.959</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[4]</td>
<td style="text-align: right;">-5.2992147</td>
<td style="text-align: right;">-5.654110</td>
<td style="text-align: right;">44.55179</td>
<td style="text-align: right;">44.68963</td>
<td style="text-align: right;">-76.99112</td>
<td style="text-align: right;">69.610760</td>
<td style="text-align: right;">1.0045856</td>
<td style="text-align: right;">1224.3063</td>
<td style="text-align: right;">2256.547</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[5]</td>
<td style="text-align: right;">30.3113768</td>
<td style="text-align: right;">29.543400</td>
<td style="text-align: right;">42.38094</td>
<td style="text-align: right;">41.45215</td>
<td style="text-align: right;">-39.11666</td>
<td style="text-align: right;">100.252400</td>
<td style="text-align: right;">1.0034798</td>
<td style="text-align: right;">1177.5168</td>
<td style="text-align: right;">2113.346</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[6]</td>
<td style="text-align: right;">26.9323349</td>
<td style="text-align: right;">26.880450</td>
<td style="text-align: right;">49.84920</td>
<td style="text-align: right;">50.02384</td>
<td style="text-align: right;">-54.73963</td>
<td style="text-align: right;">109.153700</td>
<td style="text-align: right;">1.0019540</td>
<td style="text-align: right;">1021.3164</td>
<td style="text-align: right;">1945.278</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[7]</td>
<td style="text-align: right;">-22.0047994</td>
<td style="text-align: right;">-22.536200</td>
<td style="text-align: right;">44.50398</td>
<td style="text-align: right;">43.09286</td>
<td style="text-align: right;">-93.98499</td>
<td style="text-align: right;">52.478050</td>
<td style="text-align: right;">1.0023323</td>
<td style="text-align: right;">1013.5464</td>
<td style="text-align: right;">1734.567</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[8]</td>
<td style="text-align: right;">-23.5087934</td>
<td style="text-align: right;">-23.616200</td>
<td style="text-align: right;">39.22542</td>
<td style="text-align: right;">39.91782</td>
<td style="text-align: right;">-86.12511</td>
<td style="text-align: right;">41.594785</td>
<td style="text-align: right;">1.0020964</td>
<td style="text-align: right;">1214.9692</td>
<td style="text-align: right;">1874.695</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[9]</td>
<td style="text-align: right;">-5.9730906</td>
<td style="text-align: right;">-6.426470</td>
<td style="text-align: right;">47.02058</td>
<td style="text-align: right;">45.57334</td>
<td style="text-align: right;">-83.39477</td>
<td style="text-align: right;">72.921790</td>
<td style="text-align: right;">1.0032518</td>
<td style="text-align: right;">970.1958</td>
<td style="text-align: right;">1664.932</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[10]</td>
<td style="text-align: right;">-40.0611391</td>
<td style="text-align: right;">-39.870950</td>
<td style="text-align: right;">39.92821</td>
<td style="text-align: right;">40.74941</td>
<td style="text-align: right;">-107.42520</td>
<td style="text-align: right;">24.485650</td>
<td style="text-align: right;">1.0024596</td>
<td style="text-align: right;">1065.5642</td>
<td style="text-align: right;">1816.300</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[11]</td>
<td style="text-align: right;">12.3690618</td>
<td style="text-align: right;">11.115450</td>
<td style="text-align: right;">39.21370</td>
<td style="text-align: right;">38.48251</td>
<td style="text-align: right;">-51.03536</td>
<td style="text-align: right;">77.272090</td>
<td style="text-align: right;">1.0028023</td>
<td style="text-align: right;">1209.7953</td>
<td style="text-align: right;">1967.864</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[12]</td>
<td style="text-align: right;">-10.8834250</td>
<td style="text-align: right;">-11.677850</td>
<td style="text-align: right;">57.82268</td>
<td style="text-align: right;">56.66586</td>
<td style="text-align: right;">-106.39880</td>
<td style="text-align: right;">86.875145</td>
<td style="text-align: right;">1.0037868</td>
<td style="text-align: right;">928.9854</td>
<td style="text-align: right;">1671.307</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[13]</td>
<td style="text-align: right;">-53.3191932</td>
<td style="text-align: right;">-52.443200</td>
<td style="text-align: right;">34.73054</td>
<td style="text-align: right;">34.41619</td>
<td style="text-align: right;">-110.73450</td>
<td style="text-align: right;">4.321743</td>
<td style="text-align: right;">1.0012426</td>
<td style="text-align: right;">1197.7160</td>
<td style="text-align: right;">2086.533</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[14]</td>
<td style="text-align: right;">20.3664969</td>
<td style="text-align: right;">20.474050</td>
<td style="text-align: right;">41.16614</td>
<td style="text-align: right;">40.89885</td>
<td style="text-align: right;">-48.17345</td>
<td style="text-align: right;">88.103275</td>
<td style="text-align: right;">1.0040288</td>
<td style="text-align: right;">1115.5183</td>
<td style="text-align: right;">1974.671</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[15]</td>
<td style="text-align: right;">-65.0337481</td>
<td style="text-align: right;">-65.418500</td>
<td style="text-align: right;">40.04361</td>
<td style="text-align: right;">41.24615</td>
<td style="text-align: right;">-129.99165</td>
<td style="text-align: right;">-1.340416</td>
<td style="text-align: right;">1.0025199</td>
<td style="text-align: right;">1186.6682</td>
<td style="text-align: right;">1959.796</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[16]</td>
<td style="text-align: right;">36.7381204</td>
<td style="text-align: right;">36.936650</td>
<td style="text-align: right;">42.51766</td>
<td style="text-align: right;">43.71792</td>
<td style="text-align: right;">-31.41237</td>
<td style="text-align: right;">106.561150</td>
<td style="text-align: right;">1.0038031</td>
<td style="text-align: right;">1106.2096</td>
<td style="text-align: right;">1947.284</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[17]</td>
<td style="text-align: right;">-6.5297662</td>
<td style="text-align: right;">-6.968465</td>
<td style="text-align: right;">76.99477</td>
<td style="text-align: right;">77.04647</td>
<td style="text-align: right;">-131.38500</td>
<td style="text-align: right;">117.659850</td>
<td style="text-align: right;">0.9998657</td>
<td style="text-align: right;">1452.0515</td>
<td style="text-align: right;">1819.239</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[18]</td>
<td style="text-align: right;">-6.9524161</td>
<td style="text-align: right;">-7.279275</td>
<td style="text-align: right;">57.04592</td>
<td style="text-align: right;">55.84395</td>
<td style="text-align: right;">-99.44985</td>
<td style="text-align: right;">88.337640</td>
<td style="text-align: right;">1.0063563</td>
<td style="text-align: right;">893.7662</td>
<td style="text-align: right;">1830.437</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[19]</td>
<td style="text-align: right;">35.9527815</td>
<td style="text-align: right;">36.639500</td>
<td style="text-align: right;">41.89463</td>
<td style="text-align: right;">42.54254</td>
<td style="text-align: right;">-33.32637</td>
<td style="text-align: right;">104.038700</td>
<td style="text-align: right;">1.0040602</td>
<td style="text-align: right;">1155.6837</td>
<td style="text-align: right;">2119.130</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[20]</td>
<td style="text-align: right;">117.8131092</td>
<td style="text-align: right;">117.125500</td>
<td style="text-align: right;">45.64826</td>
<td style="text-align: right;">45.35051</td>
<td style="text-align: right;">42.56121</td>
<td style="text-align: right;">194.177850</td>
<td style="text-align: right;">1.0038081</td>
<td style="text-align: right;">1052.8538</td>
<td style="text-align: right;">2051.323</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[21]</td>
<td style="text-align: right;">-0.4748713</td>
<td style="text-align: right;">-2.133635</td>
<td style="text-align: right;">48.06289</td>
<td style="text-align: right;">48.49763</td>
<td style="text-align: right;">-79.04878</td>
<td style="text-align: right;">81.472015</td>
<td style="text-align: right;">1.0011506</td>
<td style="text-align: right;">1044.1363</td>
<td style="text-align: right;">1628.391</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[22]</td>
<td style="text-align: right;">-18.4004635</td>
<td style="text-align: right;">-19.657200</td>
<td style="text-align: right;">47.63894</td>
<td style="text-align: right;">48.53803</td>
<td style="text-align: right;">-94.28130</td>
<td style="text-align: right;">60.872955</td>
<td style="text-align: right;">1.0010086</td>
<td style="text-align: right;">1034.5092</td>
<td style="text-align: right;">1856.102</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta0[23]</td>
<td style="text-align: right;">95.1552180</td>
<td style="text-align: right;">95.204100</td>
<td style="text-align: right;">48.17842</td>
<td style="text-align: right;">48.89896</td>
<td style="text-align: right;">15.62161</td>
<td style="text-align: right;">175.492450</td>
<td style="text-align: right;">1.0003122</td>
<td style="text-align: right;">1385.1658</td>
<td style="text-align: right;">2359.916</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta0[24]</td>
<td style="text-align: right;">-82.2773309</td>
<td style="text-align: right;">-82.631500</td>
<td style="text-align: right;">38.25178</td>
<td style="text-align: right;">38.38904</td>
<td style="text-align: right;">-144.60515</td>
<td style="text-align: right;">-18.692770</td>
<td style="text-align: right;">1.0026957</td>
<td style="text-align: right;">1459.8191</td>
<td style="text-align: right;">2454.338</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-70_32883fbd4aa5f2a62fa1d081865e41be">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel1<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 11%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 9%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta1[1]</td>
<td style="text-align: right;">55.037171</td>
<td style="text-align: right;">55.008250</td>
<td style="text-align: right;">36.805888</td>
<td style="text-align: right;">35.901455</td>
<td style="text-align: right;">-5.415921</td>
<td style="text-align: right;">114.768600</td>
<td style="text-align: right;">1.005744</td>
<td style="text-align: right;">784.5144</td>
<td style="text-align: right;">1421.307</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta1[2]</td>
<td style="text-align: right;">32.869991</td>
<td style="text-align: right;">33.206700</td>
<td style="text-align: right;">36.572487</td>
<td style="text-align: right;">36.858652</td>
<td style="text-align: right;">-27.097930</td>
<td style="text-align: right;">92.077495</td>
<td style="text-align: right;">1.004768</td>
<td style="text-align: right;">788.3512</td>
<td style="text-align: right;">1355.927</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta1[3]</td>
<td style="text-align: right;">25.401262</td>
<td style="text-align: right;">25.573950</td>
<td style="text-align: right;">16.774440</td>
<td style="text-align: right;">16.887629</td>
<td style="text-align: right;">-2.566794</td>
<td style="text-align: right;">52.859595</td>
<td style="text-align: right;">1.000830</td>
<td style="text-align: right;">1974.5697</td>
<td style="text-align: right;">2949.570</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta1[4]</td>
<td style="text-align: right;">103.837487</td>
<td style="text-align: right;">103.980000</td>
<td style="text-align: right;">16.852856</td>
<td style="text-align: right;">17.069544</td>
<td style="text-align: right;">76.043700</td>
<td style="text-align: right;">131.677000</td>
<td style="text-align: right;">1.001406</td>
<td style="text-align: right;">2018.1968</td>
<td style="text-align: right;">2603.911</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta1[5]</td>
<td style="text-align: right;">305.132824</td>
<td style="text-align: right;">305.143000</td>
<td style="text-align: right;">16.754248</td>
<td style="text-align: right;">16.515423</td>
<td style="text-align: right;">277.393350</td>
<td style="text-align: right;">332.510300</td>
<td style="text-align: right;">1.001597</td>
<td style="text-align: right;">1963.1569</td>
<td style="text-align: right;">2529.379</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta1[6]</td>
<td style="text-align: right;">28.242591</td>
<td style="text-align: right;">28.477700</td>
<td style="text-align: right;">16.190405</td>
<td style="text-align: right;">16.240030</td>
<td style="text-align: right;">1.606297</td>
<td style="text-align: right;">54.640115</td>
<td style="text-align: right;">1.000129</td>
<td style="text-align: right;">2161.6143</td>
<td style="text-align: right;">2759.796</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta1[7]</td>
<td style="text-align: right;">81.522995</td>
<td style="text-align: right;">81.592300</td>
<td style="text-align: right;">15.804317</td>
<td style="text-align: right;">16.090065</td>
<td style="text-align: right;">55.382440</td>
<td style="text-align: right;">107.286100</td>
<td style="text-align: right;">1.000071</td>
<td style="text-align: right;">2532.5680</td>
<td style="text-align: right;">2971.976</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta1[8]</td>
<td style="text-align: right;">147.026742</td>
<td style="text-align: right;">147.165000</td>
<td style="text-align: right;">16.126942</td>
<td style="text-align: right;">15.912005</td>
<td style="text-align: right;">120.748250</td>
<td style="text-align: right;">173.449800</td>
<td style="text-align: right;">1.000301</td>
<td style="text-align: right;">2432.1714</td>
<td style="text-align: right;">2926.234</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta1[9]</td>
<td style="text-align: right;">-1.850480</td>
<td style="text-align: right;">-2.402295</td>
<td style="text-align: right;">97.075735</td>
<td style="text-align: right;">97.506517</td>
<td style="text-align: right;">-162.360550</td>
<td style="text-align: right;">159.924500</td>
<td style="text-align: right;">1.001426</td>
<td style="text-align: right;">3442.9172</td>
<td style="text-align: right;">2941.997</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta1[10]</td>
<td style="text-align: right;">7.555273</td>
<td style="text-align: right;">7.717015</td>
<td style="text-align: right;">17.430173</td>
<td style="text-align: right;">17.365879</td>
<td style="text-align: right;">-21.237040</td>
<td style="text-align: right;">35.596250</td>
<td style="text-align: right;">1.005791</td>
<td style="text-align: right;">804.4808</td>
<td style="text-align: right;">1202.213</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta1[11]</td>
<td style="text-align: right;">-1.615427</td>
<td style="text-align: right;">-1.695375</td>
<td style="text-align: right;">3.817813</td>
<td style="text-align: right;">3.786541</td>
<td style="text-align: right;">-7.963766</td>
<td style="text-align: right;">4.814342</td>
<td style="text-align: right;">1.001961</td>
<td style="text-align: right;">795.7934</td>
<td style="text-align: right;">1116.442</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta1[12]</td>
<td style="text-align: right;">14.805794</td>
<td style="text-align: right;">14.910700</td>
<td style="text-align: right;">43.568764</td>
<td style="text-align: right;">45.090833</td>
<td style="text-align: right;">-56.276075</td>
<td style="text-align: right;">83.871055</td>
<td style="text-align: right;">1.002835</td>
<td style="text-align: right;">1022.7766</td>
<td style="text-align: right;">1651.278</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-71_87fd92c12b63d275fd0282425c35aebe">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel1<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"sigma"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sigma</td>
<td style="text-align: right;">151.0318</td>
<td style="text-align: right;">150.8665</td>
<td style="text-align: right;">4.236681</td>
<td style="text-align: right;">4.070478</td>
<td style="text-align: right;">144.2211</td>
<td style="text-align: right;">158.1974</td>
<td style="text-align: right;">1.001034</td>
<td style="text-align: right;">3712.42</td>
<td style="text-align: right;">3035.375</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-72_69f65d6e23947811cbdf172e6ffb1228">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Multinivel1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta0"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-72-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-73_5efce43fff942a9a2cc2ce51ab2848bf">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Multinivel1<span class="sc">$</span><span class="fu">draws</span>(</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"beta1[1]"</span>,<span class="st">"beta1[2]"</span>,<span class="st">"beta1[9]"</span>,<span class="st">"beta1[12]"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-73-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-74_c98b7662712701bae6d5395269968e0e">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Multinivel1<span class="sc">$</span><span class="fu">draws</span>(</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"beta1[3]"</span>,<span class="st">"beta1[4]"</span>,<span class="st">"beta1[5]"</span>,<span class="st">"beta1[6]"</span>, <span class="st">"sigma"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-75_a5788f17dc5238c77ec697b13fdd8bff">
<div class="sourceCode cell-code" id="cb83"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Multinivel1<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"beta0"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-75-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-76_3ef98dec6613387f67190d4461c52dc1">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Multinivel1<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"beta1"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-76-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-77_901b730b44c516b4312e11998dd3464d">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dataMultinivel)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_Multinivel1<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"mu"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> dataMultinivel<span class="sc">$</span>prom_Ingreso, </span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a>                 y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-77-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Ahora, podemos escribir el modelo en stan empleando el<br>
<span class="math display">\[y_{ij} = \gamma_0 + \gamma_1 U_{j} + \beta X_{ij} + \epsilon_{ij}+e_{j}\]</span></p>
<p>Creando código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-78_bdee4891c58b5054714cb41fa1078e60">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>data {</span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a>  int <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span>N;                       <span class="sc">/</span><span class="er">/</span> Número de observaciones</span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>  int <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span>k;                       <span class="sc">/</span><span class="er">/</span> Número de covariables </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  vector[N] y;                          <span class="sc">/</span><span class="er">/</span> Variables respuesta</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a>  matrix [N,k] X;                        <span class="sc">/</span><span class="er">/</span> Variables regresoras</span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a>  <span class="sc">/</span><span class="er">/</span> efecto aleatorio </span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>  int <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span>kz; </span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a>  matrix [N,kz] Z;                        <span class="sc">/</span><span class="er">/</span> Variables regresoras</span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>parameters {</span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  vector[k] beta;         <span class="sc">/</span><span class="er">/</span> coeficientes del modelo</span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  vector[kz] u;         <span class="sc">/</span><span class="er">/</span> coeficientes del modelo</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a>  real <span class="sc">&lt;</span>lower <span class="ot">=</span> <span class="dv">0</span><span class="sc">&gt;</span> sigma;</span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a>transformed parameters{</span>
<span id="cb86-18"><a href="#cb86-18" aria-hidden="true" tabindex="-1"></a> vector[N] mu;</span>
<span id="cb86-19"><a href="#cb86-19" aria-hidden="true" tabindex="-1"></a> mu <span class="ot">=</span>  X<span class="sc">*</span>beta <span class="sc">+</span> Z <span class="sc">*</span> u;</span>
<span id="cb86-20"><a href="#cb86-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb86-21"><a href="#cb86-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-22"><a href="#cb86-22" aria-hidden="true" tabindex="-1"></a>model {</span>
<span id="cb86-23"><a href="#cb86-23" aria-hidden="true" tabindex="-1"></a>  beta <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span>);</span>
<span id="cb86-24"><a href="#cb86-24" aria-hidden="true" tabindex="-1"></a>  u <span class="sc">~</span> <span class="fu">normal</span>(<span class="dv">0</span>,<span class="dv">100</span>);</span>
<span id="cb86-25"><a href="#cb86-25" aria-hidden="true" tabindex="-1"></a>  sigma <span class="sc">~</span> <span class="fu">cauchy</span>(<span class="dv">0</span>,<span class="dv">100</span>);</span>
<span id="cb86-26"><a href="#cb86-26" aria-hidden="true" tabindex="-1"></a>  y <span class="sc">~</span> <span class="fu">normal</span>(mu , sigma);</span>
<span id="cb86-27"><a href="#cb86-27" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Preparando el código de <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-79_a66502e0a7f640e697c3f586e716d7e9">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>fitMultinivel2 <span class="ot">&lt;-</span> <span class="fu">cmdstan_model</span>(<span class="at">stan_file =</span> <span class="st">"Data/modelosStan/Multinivel_Intercepto2.stan"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Organizando datos para <code>STAN</code></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-80_b25e510b9e786e5744925f3b01ab642f">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>Zdat <span class="ot">&lt;-</span> <span class="fu">model.matrix</span>(prom_Ingreso <span class="sc">~</span> provincia,</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>                     <span class="at">data =</span> dataMultinivel)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(Zdat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
<col style="width: 4%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: right;">(Intercept)</th>
<th style="text-align: right;">provincia02</th>
<th style="text-align: right;">provincia03</th>
<th style="text-align: right;">provincia04</th>
<th style="text-align: right;">provincia05</th>
<th style="text-align: right;">provincia06</th>
<th style="text-align: right;">provincia07</th>
<th style="text-align: right;">provincia08</th>
<th style="text-align: right;">provincia09</th>
<th style="text-align: right;">provincia10</th>
<th style="text-align: right;">provincia11</th>
<th style="text-align: right;">provincia12</th>
<th style="text-align: right;">provincia13</th>
<th style="text-align: right;">provincia14</th>
<th style="text-align: right;">provincia15</th>
<th style="text-align: right;">provincia16</th>
<th style="text-align: right;">provincia17</th>
<th style="text-align: right;">provincia18</th>
<th style="text-align: right;">provincia19</th>
<th style="text-align: right;">provincia20</th>
<th style="text-align: right;">provincia21</th>
<th style="text-align: right;">provincia22</th>
<th style="text-align: right;">provincia23</th>
<th style="text-align: right;">provincia24</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
<tr class="even">
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-81_ce87b06ea33fa04c1438a53aba9f386a">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>sample_data <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="at">N =</span> <span class="fu">nrow</span>(dataMultinivel),</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>                    <span class="at">k =</span> <span class="fu">ncol</span>(Xdat),</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>                    <span class="at">X =</span> <span class="fu">as.matrix</span>(Xdat),</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>                    <span class="at">y =</span> dataMultinivel<span class="sc">$</span>prom_Ingreso,</span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a>                    <span class="at">kz =</span> <span class="fu">ncol</span>(Zdat),</span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>                    <span class="at">Z =</span> <span class="fu">as.matrix</span>(Zdat) </span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>                    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Para ejecutar <code>STAN</code> en R tenemos la librería <em>cmdstanr</em></p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-82_cd8f6730a78e7a7014ae9d597f9b15cd">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel2 <span class="ot">&lt;-</span> fitMultinivel2<span class="sc">$</span><span class="fu">sample</span>(</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> sample_data, </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>                 <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>                 <span class="at">parallel_chains =</span> <span class="dv">4</span>,</span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a>                 <span class="at">seed =</span> <span class="dv">1234</span>,</span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a>                 <span class="at">refresh =</span> <span class="dv">1000</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Running MCMC with 4 parallel chains...

Chain 1 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 3 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 4 Iteration:    1 / 2000 [  0%]  (Warmup) 
Chain 2 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 3 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 2 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 1 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 1 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 4 Iteration: 1000 / 2000 [ 50%]  (Warmup) 
Chain 4 Iteration: 1001 / 2000 [ 50%]  (Sampling) 
Chain 3 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 3 finished in 123.0 seconds.
Chain 2 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 2 finished in 127.0 seconds.
Chain 4 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 4 finished in 126.9 seconds.
Chain 1 Iteration: 2000 / 2000 [100%]  (Sampling) 
Chain 1 finished in 132.4 seconds.

All 4 chains finished successfully.
Mean chain execution time: 127.3 seconds.
Total execution time: 133.1 seconds.</code></pre>
</div>
</div>
<p>La estimación de los parámetros:</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-83_e4d94507b8d597655fd19aa8f671d67b">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel2<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"beta"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 11%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 8%">
<col style="width: 8%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">beta[1]</td>
<td style="text-align: right;">12.268465</td>
<td style="text-align: right;">13.0667500</td>
<td style="text-align: right;">71.66509</td>
<td style="text-align: right;">70.60682</td>
<td style="text-align: right;">-106.224100</td>
<td style="text-align: right;">130.64535</td>
<td style="text-align: right;">1.0007004</td>
<td style="text-align: right;">3142.211</td>
<td style="text-align: right;">2736.266</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[2]</td>
<td style="text-align: right;">-9.675487</td>
<td style="text-align: right;">-9.0575550</td>
<td style="text-align: right;">71.84446</td>
<td style="text-align: right;">70.77132</td>
<td style="text-align: right;">-128.742400</td>
<td style="text-align: right;">108.41420</td>
<td style="text-align: right;">1.0010868</td>
<td style="text-align: right;">3177.823</td>
<td style="text-align: right;">2695.137</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[3]</td>
<td style="text-align: right;">23.502332</td>
<td style="text-align: right;">23.5179000</td>
<td style="text-align: right;">16.51467</td>
<td style="text-align: right;">16.51505</td>
<td style="text-align: right;">-4.228587</td>
<td style="text-align: right;">50.36470</td>
<td style="text-align: right;">1.0017483</td>
<td style="text-align: right;">4096.532</td>
<td style="text-align: right;">3427.944</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[4]</td>
<td style="text-align: right;">101.814963</td>
<td style="text-align: right;">102.0110000</td>
<td style="text-align: right;">16.74862</td>
<td style="text-align: right;">16.52417</td>
<td style="text-align: right;">74.290865</td>
<td style="text-align: right;">129.42450</td>
<td style="text-align: right;">1.0003510</td>
<td style="text-align: right;">3736.460</td>
<td style="text-align: right;">2880.332</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[5]</td>
<td style="text-align: right;">303.533653</td>
<td style="text-align: right;">303.8215000</td>
<td style="text-align: right;">16.87395</td>
<td style="text-align: right;">17.03582</td>
<td style="text-align: right;">275.296800</td>
<td style="text-align: right;">331.44205</td>
<td style="text-align: right;">1.0031509</td>
<td style="text-align: right;">4018.886</td>
<td style="text-align: right;">2820.199</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[6]</td>
<td style="text-align: right;">27.202867</td>
<td style="text-align: right;">27.0165500</td>
<td style="text-align: right;">16.13902</td>
<td style="text-align: right;">15.97865</td>
<td style="text-align: right;">0.654240</td>
<td style="text-align: right;">53.58622</td>
<td style="text-align: right;">1.0008208</td>
<td style="text-align: right;">3704.358</td>
<td style="text-align: right;">3107.567</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[7]</td>
<td style="text-align: right;">80.666508</td>
<td style="text-align: right;">80.5024500</td>
<td style="text-align: right;">16.07540</td>
<td style="text-align: right;">16.71958</td>
<td style="text-align: right;">55.009370</td>
<td style="text-align: right;">106.70650</td>
<td style="text-align: right;">1.0004583</td>
<td style="text-align: right;">3615.964</td>
<td style="text-align: right;">2990.342</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[8]</td>
<td style="text-align: right;">145.365385</td>
<td style="text-align: right;">145.1960000</td>
<td style="text-align: right;">16.30958</td>
<td style="text-align: right;">15.98688</td>
<td style="text-align: right;">118.929850</td>
<td style="text-align: right;">172.40630</td>
<td style="text-align: right;">1.0025865</td>
<td style="text-align: right;">3514.922</td>
<td style="text-align: right;">2823.489</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[9]</td>
<td style="text-align: right;">-0.238117</td>
<td style="text-align: right;">0.1644545</td>
<td style="text-align: right;">101.00280</td>
<td style="text-align: right;">98.32878</td>
<td style="text-align: right;">-167.551700</td>
<td style="text-align: right;">164.59885</td>
<td style="text-align: right;">1.0000491</td>
<td style="text-align: right;">5062.754</td>
<td style="text-align: right;">2666.507</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[10]</td>
<td style="text-align: right;">20.345920</td>
<td style="text-align: right;">19.6685500</td>
<td style="text-align: right;">58.29750</td>
<td style="text-align: right;">58.60525</td>
<td style="text-align: right;">-74.017785</td>
<td style="text-align: right;">116.18750</td>
<td style="text-align: right;">1.0033628</td>
<td style="text-align: right;">1080.313</td>
<td style="text-align: right;">1868.329</td>
</tr>
<tr class="odd">
<td style="text-align: left;">beta[11]</td>
<td style="text-align: right;">-1.337963</td>
<td style="text-align: right;">-1.5086000</td>
<td style="text-align: right;">28.68183</td>
<td style="text-align: right;">28.62107</td>
<td style="text-align: right;">-49.774390</td>
<td style="text-align: right;">45.42652</td>
<td style="text-align: right;">1.0044874</td>
<td style="text-align: right;">841.775</td>
<td style="text-align: right;">1232.155</td>
</tr>
<tr class="even">
<td style="text-align: left;">beta[12]</td>
<td style="text-align: right;">2.249895</td>
<td style="text-align: right;">3.3669200</td>
<td style="text-align: right;">94.96639</td>
<td style="text-align: right;">95.89291</td>
<td style="text-align: right;">-155.667950</td>
<td style="text-align: right;">156.69635</td>
<td style="text-align: right;">0.9997756</td>
<td style="text-align: right;">3492.739</td>
<td style="text-align: right;">2643.853</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-84_7de6196b39ae54f4c0f6c2a4194beb4e">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel2<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"u"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 9%">
<col style="width: 13%">
<col style="width: 12%">
<col style="width: 9%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 9%">
<col style="width: 10%">
<col style="width: 9%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">u[1]</td>
<td style="text-align: right;">80.6933037</td>
<td style="text-align: right;">85.753100</td>
<td style="text-align: right;">320.2028</td>
<td style="text-align: right;">312.0310</td>
<td style="text-align: right;">-435.0894</td>
<td style="text-align: right;">605.32085</td>
<td style="text-align: right;">1.006886</td>
<td style="text-align: right;">776.9538</td>
<td style="text-align: right;">1247.089</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[2]</td>
<td style="text-align: right;">-108.9228475</td>
<td style="text-align: right;">-114.197500</td>
<td style="text-align: right;">245.7439</td>
<td style="text-align: right;">250.2080</td>
<td style="text-align: right;">-514.9920</td>
<td style="text-align: right;">306.88695</td>
<td style="text-align: right;">1.003646</td>
<td style="text-align: right;">1027.4027</td>
<td style="text-align: right;">1729.494</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[3]</td>
<td style="text-align: right;">-110.8972778</td>
<td style="text-align: right;">-110.151500</td>
<td style="text-align: right;">174.6965</td>
<td style="text-align: right;">175.8784</td>
<td style="text-align: right;">-395.4221</td>
<td style="text-align: right;">174.54400</td>
<td style="text-align: right;">1.003533</td>
<td style="text-align: right;">865.9241</td>
<td style="text-align: right;">1474.677</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[4]</td>
<td style="text-align: right;">-80.7017392</td>
<td style="text-align: right;">-80.376300</td>
<td style="text-align: right;">266.2107</td>
<td style="text-align: right;">267.9844</td>
<td style="text-align: right;">-512.4108</td>
<td style="text-align: right;">360.46670</td>
<td style="text-align: right;">1.003386</td>
<td style="text-align: right;">999.3764</td>
<td style="text-align: right;">1670.306</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[5]</td>
<td style="text-align: right;">-48.0287282</td>
<td style="text-align: right;">-42.257300</td>
<td style="text-align: right;">250.7245</td>
<td style="text-align: right;">250.6051</td>
<td style="text-align: right;">-456.5787</td>
<td style="text-align: right;">366.96235</td>
<td style="text-align: right;">1.003361</td>
<td style="text-align: right;">985.9786</td>
<td style="text-align: right;">1587.425</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[6]</td>
<td style="text-align: right;">-53.7516026</td>
<td style="text-align: right;">-48.247650</td>
<td style="text-align: right;">349.2874</td>
<td style="text-align: right;">349.2249</td>
<td style="text-align: right;">-625.0245</td>
<td style="text-align: right;">524.46045</td>
<td style="text-align: right;">1.003765</td>
<td style="text-align: right;">937.7625</td>
<td style="text-align: right;">1453.229</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[7]</td>
<td style="text-align: right;">-126.4997696</td>
<td style="text-align: right;">-126.276000</td>
<td style="text-align: right;">120.3921</td>
<td style="text-align: right;">119.8971</td>
<td style="text-align: right;">-328.4129</td>
<td style="text-align: right;">75.90600</td>
<td style="text-align: right;">1.004146</td>
<td style="text-align: right;">965.0205</td>
<td style="text-align: right;">1498.065</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[8]</td>
<td style="text-align: right;">-73.9241780</td>
<td style="text-align: right;">-70.211100</td>
<td style="text-align: right;">271.9065</td>
<td style="text-align: right;">271.0867</td>
<td style="text-align: right;">-518.3056</td>
<td style="text-align: right;">366.37710</td>
<td style="text-align: right;">1.006961</td>
<td style="text-align: right;">732.7255</td>
<td style="text-align: right;">1178.780</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[9]</td>
<td style="text-align: right;">-128.0203067</td>
<td style="text-align: right;">-131.348000</td>
<td style="text-align: right;">258.8184</td>
<td style="text-align: right;">259.6671</td>
<td style="text-align: right;">-546.2641</td>
<td style="text-align: right;">296.62205</td>
<td style="text-align: right;">1.005544</td>
<td style="text-align: right;">824.1278</td>
<td style="text-align: right;">1057.722</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[10]</td>
<td style="text-align: right;">-122.2992781</td>
<td style="text-align: right;">-120.179500</td>
<td style="text-align: right;">196.1104</td>
<td style="text-align: right;">198.9809</td>
<td style="text-align: right;">-441.5476</td>
<td style="text-align: right;">204.18640</td>
<td style="text-align: right;">1.002841</td>
<td style="text-align: right;">1031.4062</td>
<td style="text-align: right;">1854.744</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[11]</td>
<td style="text-align: right;">-34.2172008</td>
<td style="text-align: right;">-33.500350</td>
<td style="text-align: right;">239.8436</td>
<td style="text-align: right;">241.8041</td>
<td style="text-align: right;">-423.1327</td>
<td style="text-align: right;">356.21150</td>
<td style="text-align: right;">1.006828</td>
<td style="text-align: right;">770.5206</td>
<td style="text-align: right;">1155.413</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[12]</td>
<td style="text-align: right;">-119.9953343</td>
<td style="text-align: right;">-117.169000</td>
<td style="text-align: right;">449.7338</td>
<td style="text-align: right;">450.2775</td>
<td style="text-align: right;">-851.8124</td>
<td style="text-align: right;">636.34405</td>
<td style="text-align: right;">1.004333</td>
<td style="text-align: right;">843.3542</td>
<td style="text-align: right;">1298.195</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[13]</td>
<td style="text-align: right;">-133.1075156</td>
<td style="text-align: right;">-133.432500</td>
<td style="text-align: right;">130.7318</td>
<td style="text-align: right;">128.6191</td>
<td style="text-align: right;">-345.2146</td>
<td style="text-align: right;">81.49362</td>
<td style="text-align: right;">1.007039</td>
<td style="text-align: right;">788.4426</td>
<td style="text-align: right;">1247.842</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[14]</td>
<td style="text-align: right;">-17.6658752</td>
<td style="text-align: right;">-16.330900</td>
<td style="text-align: right;">295.0303</td>
<td style="text-align: right;">288.1368</td>
<td style="text-align: right;">-494.2206</td>
<td style="text-align: right;">462.13750</td>
<td style="text-align: right;">1.007318</td>
<td style="text-align: right;">757.1286</td>
<td style="text-align: right;">1132.634</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[15]</td>
<td style="text-align: right;">-114.3261938</td>
<td style="text-align: right;">-113.481500</td>
<td style="text-align: right;">260.9637</td>
<td style="text-align: right;">256.0848</td>
<td style="text-align: right;">-545.9082</td>
<td style="text-align: right;">317.25675</td>
<td style="text-align: right;">1.006457</td>
<td style="text-align: right;">797.0546</td>
<td style="text-align: right;">1255.297</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[16]</td>
<td style="text-align: right;">2.0722503</td>
<td style="text-align: right;">-0.167187</td>
<td style="text-align: right;">310.1261</td>
<td style="text-align: right;">307.1569</td>
<td style="text-align: right;">-505.7865</td>
<td style="text-align: right;">514.72980</td>
<td style="text-align: right;">1.006697</td>
<td style="text-align: right;">770.0430</td>
<td style="text-align: right;">1219.315</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[17]</td>
<td style="text-align: right;">-120.3135964</td>
<td style="text-align: right;">-126.191500</td>
<td style="text-align: right;">290.7732</td>
<td style="text-align: right;">288.8066</td>
<td style="text-align: right;">-581.6921</td>
<td style="text-align: right;">370.40085</td>
<td style="text-align: right;">1.002927</td>
<td style="text-align: right;">1699.2915</td>
<td style="text-align: right;">2118.843</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[18]</td>
<td style="text-align: right;">-140.9537092</td>
<td style="text-align: right;">-139.796000</td>
<td style="text-align: right;">147.5286</td>
<td style="text-align: right;">147.6937</td>
<td style="text-align: right;">-383.6246</td>
<td style="text-align: right;">103.93980</td>
<td style="text-align: right;">1.006229</td>
<td style="text-align: right;">820.3531</td>
<td style="text-align: right;">1313.387</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[19]</td>
<td style="text-align: right;">0.3886828</td>
<td style="text-align: right;">1.152320</td>
<td style="text-align: right;">296.8448</td>
<td style="text-align: right;">292.3304</td>
<td style="text-align: right;">-483.2713</td>
<td style="text-align: right;">485.19925</td>
<td style="text-align: right;">1.006318</td>
<td style="text-align: right;">762.3765</td>
<td style="text-align: right;">1137.000</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[20]</td>
<td style="text-align: right;">90.5658840</td>
<td style="text-align: right;">89.708000</td>
<td style="text-align: right;">293.5833</td>
<td style="text-align: right;">287.3316</td>
<td style="text-align: right;">-402.5331</td>
<td style="text-align: right;">575.94075</td>
<td style="text-align: right;">1.005517</td>
<td style="text-align: right;">894.9692</td>
<td style="text-align: right;">1465.408</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[21]</td>
<td style="text-align: right;">-68.5807633</td>
<td style="text-align: right;">-62.517950</td>
<td style="text-align: right;">253.4809</td>
<td style="text-align: right;">249.7610</td>
<td style="text-align: right;">-486.4742</td>
<td style="text-align: right;">343.52970</td>
<td style="text-align: right;">1.006727</td>
<td style="text-align: right;">765.5066</td>
<td style="text-align: right;">1144.374</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[22]</td>
<td style="text-align: right;">-84.3687014</td>
<td style="text-align: right;">-78.741050</td>
<td style="text-align: right;">265.8364</td>
<td style="text-align: right;">262.2478</td>
<td style="text-align: right;">-519.5766</td>
<td style="text-align: right;">350.41650</td>
<td style="text-align: right;">1.006740</td>
<td style="text-align: right;">754.5923</td>
<td style="text-align: right;">1088.621</td>
</tr>
<tr class="odd">
<td style="text-align: left;">u[23]</td>
<td style="text-align: right;">26.7035059</td>
<td style="text-align: right;">27.312000</td>
<td style="text-align: right;">257.0227</td>
<td style="text-align: right;">253.6973</td>
<td style="text-align: right;">-396.3139</td>
<td style="text-align: right;">444.42930</td>
<td style="text-align: right;">1.004600</td>
<td style="text-align: right;">841.4908</td>
<td style="text-align: right;">1232.909</td>
</tr>
<tr class="even">
<td style="text-align: left;">u[24]</td>
<td style="text-align: right;">-165.5577269</td>
<td style="text-align: right;">-165.397500</td>
<td style="text-align: right;">132.1382</td>
<td style="text-align: right;">132.9970</td>
<td style="text-align: right;">-377.7013</td>
<td style="text-align: right;">45.10845</td>
<td style="text-align: right;">1.005454</td>
<td style="text-align: right;">838.8367</td>
<td style="text-align: right;">1216.461</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-85_2171e658f034ac4dfdc1d2134d76fd06">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>model_Multinivel2<span class="sc">$</span><span class="fu">summary</span>(<span class="at">variables =</span> <span class="fu">c</span>(<span class="st">"sigma"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-sm table-striped">
<colgroup>
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 8%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
<col style="width: 10%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: right;">mean</th>
<th style="text-align: right;">median</th>
<th style="text-align: right;">sd</th>
<th style="text-align: right;">mad</th>
<th style="text-align: right;">q5</th>
<th style="text-align: right;">q95</th>
<th style="text-align: right;">rhat</th>
<th style="text-align: right;">ess_bulk</th>
<th style="text-align: right;">ess_tail</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">sigma</td>
<td style="text-align: right;">151.2008</td>
<td style="text-align: right;">151.1585</td>
<td style="text-align: right;">4.238971</td>
<td style="text-align: right;">4.192793</td>
<td style="text-align: right;">144.325</td>
<td style="text-align: right;">158.2006</td>
<td style="text-align: right;">1.000991</td>
<td style="text-align: right;">4654.548</td>
<td style="text-align: right;">2747.889</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-86_997be0f81ed07a68a522442d0d17b7d5">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Multinivel2<span class="sc">$</span><span class="fu">draws</span>(</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"beta[1]"</span>,<span class="st">"beta[2]"</span>,<span class="st">"beta[12]"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-86-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-87_ecd35c7f9be674ac6cd6b8b30d3c5b0c">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_areas</span>(model_Multinivel2<span class="sc">$</span><span class="fu">draws</span>(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">c</span>(<span class="st">"beta[3]"</span>,<span class="st">"beta[4]"</span>,<span class="st">"beta[5]"</span>,<span class="st">"beta[6]"</span>, <span class="st">"sigma"</span>))) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-87-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-88_7f7bbaa9662853ba2557c776b84ab640">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Multinivel2<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"beta"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-88-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-89_e7a2a9b48dc8ed878f997a93533523d1">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mcmc_trace</span>(model_Multinivel2<span class="sc">$</span><span class="fu">draws</span>(<span class="st">"u"</span>)) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-89-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-90_e38300d028ebdad6e4d24670da9f57a5">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(dataMultinivel)</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> model_Multinivel2<span class="sc">$</span><span class="fu">draws</span>(<span class="at">variables =</span> <span class="st">"mu"</span>, <span class="at">format =</span> <span class="st">"matrix"</span>)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> dataMultinivel<span class="sc">$</span>prom_Ingreso, </span>
<span id="cb99-6"><a href="#cb99-6" aria-hidden="true" tabindex="-1"></a>                 y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-90-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="práctica-en-r-1" class="level3">
<h3 class="anchored" data-anchor-id="práctica-en-r-1">Práctica en <code>R</code></h3>
<p>Datos de la encuesta</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-91_755e6e5b3db0f80354dbac06f73999f5">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>fit_stan <span class="ot">&lt;-</span> <span class="fu">stan_lmer</span>(</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>  prom_Ingreso <span class="sc">~</span> (<span class="dv">1</span> <span class="sc">|</span></span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a>                       provincia) <span class="sc">+</span> sexo <span class="sc">+</span> anoest <span class="sc">+</span> edad <span class="sc">+</span> tasa_desocupacion <span class="sc">+</span> Luces_nocturna <span class="sc">+</span> Suelo_cultivo <span class="sc">+</span> Suelo_urbano,</span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dataMultinivel,</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span>,</span>
<span id="cb100-7"><a href="#cb100-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">cores =</span> <span class="dv">7</span>,</span>
<span id="cb100-8"><a href="#cb100-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">chains =</span> <span class="dv">4</span>,</span>
<span id="cb100-9"><a href="#cb100-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">iter =</span> <span class="dv">2000</span>, </span>
<span id="cb100-10"><a href="#cb100-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
CHECKING DATA AND PREPROCESSING FOR MODEL 'continuous' NOW.

COMPILING MODEL 'continuous' NOW.

STARTING SAMPLER FOR MODEL 'continuous' NOW.</code></pre>
</div>
</div>
<p>Parámetros estimados</p>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-92_41593b2788f8bc8861fe933e1fe4972b">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit_stan)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Model Info:
 function:     stan_lmer
 family:       gaussian [identity]
 formula:      prom_Ingreso ~ (1 | provincia) + sexo + anoest + edad + tasa_desocupacion + 
       Luces_nocturna + Suelo_cultivo + Suelo_urbano
 algorithm:    sampling
 sample:       4000 (posterior sample size)
 priors:       see help('prior_summary')
 observations: 684
 groups:       provincia (24)

Estimates:
                                           mean    sd      10%     50%  
(Intercept)                                118.9    40.3    67.3   119.1
sexoMujer                                  -21.7    11.6   -36.6   -21.6
anoest2                                     32.0    17.4    10.0    32.0
anoest3                                    111.7    17.7    89.1   111.8
anoest4                                    315.9    17.7   293.1   315.9
edad3                                       31.2    16.6     9.5    31.3
edad4                                       85.6    16.1    64.5    85.6
edad5                                      152.7    16.8   130.4   152.5
tasa_desocupacion                        -1465.2   689.0 -2350.0 -1462.0
Luces_nocturna                               4.7    10.4    -8.9     4.7
Suelo_cultivo                               -2.4     2.1    -4.9    -2.4
Suelo_urbano                                27.1    27.0    -6.8    27.1
b[(Intercept) provincia:01]                 60.2    28.6    24.2    59.5
b[(Intercept) provincia:02]                -42.5    28.1   -78.6   -42.0
b[(Intercept) provincia:03]                 -2.9    30.1   -41.7    -2.7
b[(Intercept) provincia:04]                -10.3    28.3   -47.4    -9.9
b[(Intercept) provincia:05]                  7.2    28.4   -29.1     6.9
b[(Intercept) provincia:06]                 13.1    28.5   -23.0    12.4
b[(Intercept) provincia:07]                -16.5    27.6   -51.3   -16.3
b[(Intercept) provincia:08]                 14.0    32.6   -25.9    13.6
b[(Intercept) provincia:09]                 29.7    33.0   -11.8    28.7
b[(Intercept) provincia:10]                -34.3    27.2   -69.5   -33.4
b[(Intercept) provincia:11]                 -2.1    26.9   -36.3    -2.1
b[(Intercept) provincia:12]                 10.4    32.7   -30.9    10.3
b[(Intercept) provincia:13]                -17.1    27.5   -52.4   -17.1
b[(Intercept) provincia:14]                 -9.7    28.7   -46.1    -9.4
b[(Intercept) provincia:15]                -57.8    27.8   -94.4   -57.1
b[(Intercept) provincia:16]                 12.8    28.2   -22.0    12.1
b[(Intercept) provincia:17]                -18.6    41.7   -72.6   -17.5
b[(Intercept) provincia:18]                -22.4    33.8   -64.4   -22.4
b[(Intercept) provincia:19]                  6.5    28.4   -30.1     6.3
b[(Intercept) provincia:20]                 71.7    32.1    31.6    70.2
b[(Intercept) provincia:21]                 -3.2    29.6   -39.3    -4.1
b[(Intercept) provincia:22]                -13.3    28.9   -50.1   -13.2
b[(Intercept) provincia:23]                 64.1    30.7    25.6    63.1
b[(Intercept) provincia:24]                -27.8    32.2   -69.1   -27.5
sigma                                      151.3     4.2   145.9   151.2
Sigma[provincia:(Intercept),(Intercept)]  2143.3  1115.9   998.2  1928.3
                                           90%  
(Intercept)                                169.8
sexoMujer                                   -6.6
anoest2                                     54.4
anoest3                                    134.3
anoest4                                    338.5
edad3                                       52.4
edad4                                      106.1
edad5                                      174.6
tasa_desocupacion                         -599.8
Luces_nocturna                              18.0
Suelo_cultivo                                0.2
Suelo_urbano                                62.1
b[(Intercept) provincia:01]                 96.8
b[(Intercept) provincia:02]                 -7.6
b[(Intercept) provincia:03]                 35.3
b[(Intercept) provincia:04]                 25.6
b[(Intercept) provincia:05]                 42.8
b[(Intercept) provincia:06]                 49.5
b[(Intercept) provincia:07]                 17.9
b[(Intercept) provincia:08]                 54.6
b[(Intercept) provincia:09]                 71.9
b[(Intercept) provincia:10]                 -0.5
b[(Intercept) provincia:11]                 31.6
b[(Intercept) provincia:12]                 51.8
b[(Intercept) provincia:13]                 17.1
b[(Intercept) provincia:14]                 26.2
b[(Intercept) provincia:15]                -22.3
b[(Intercept) provincia:16]                 49.2
b[(Intercept) provincia:17]                 32.1
b[(Intercept) provincia:18]                 20.4
b[(Intercept) provincia:19]                 43.4
b[(Intercept) provincia:20]                114.5
b[(Intercept) provincia:21]                 34.2
b[(Intercept) provincia:22]                 23.0
b[(Intercept) provincia:23]                103.5
b[(Intercept) provincia:24]                 12.5
sigma                                      156.8
Sigma[provincia:(Intercept),(Intercept)]  3489.4

Fit Diagnostics:
           mean   sd    10%   50%   90%
mean_PPD 260.2    8.2 249.6 260.1 270.7

The mean_ppd is the sample average posterior predictive distribution of the outcome variable (for details see help('summary.stanreg')).

MCMC diagnostics
                                         mcse Rhat n_eff
(Intercept)                               0.9  1.0 2219 
sexoMujer                                 0.1  1.0 7284 
anoest2                                   0.3  1.0 3512 
anoest3                                   0.3  1.0 3463 
anoest4                                   0.3  1.0 3455 
edad3                                     0.3  1.0 3827 
edad4                                     0.3  1.0 3580 
edad5                                     0.3  1.0 3725 
tasa_desocupacion                        15.5  1.0 1987 
Luces_nocturna                            0.3  1.0 1715 
Suelo_cultivo                             0.0  1.0 1789 
Suelo_urbano                              0.6  1.0 1935 
b[(Intercept) provincia:01]               0.5  1.0 2882 
b[(Intercept) provincia:02]               0.5  1.0 3056 
b[(Intercept) provincia:03]               0.5  1.0 3333 
b[(Intercept) provincia:04]               0.5  1.0 3840 
b[(Intercept) provincia:05]               0.5  1.0 3604 
b[(Intercept) provincia:06]               0.5  1.0 2880 
b[(Intercept) provincia:07]               0.5  1.0 3230 
b[(Intercept) provincia:08]               0.6  1.0 2933 
b[(Intercept) provincia:09]               0.6  1.0 3152 
b[(Intercept) provincia:10]               0.4  1.0 3757 
b[(Intercept) provincia:11]               0.5  1.0 3515 
b[(Intercept) provincia:12]               0.6  1.0 2777 
b[(Intercept) provincia:13]               0.5  1.0 3662 
b[(Intercept) provincia:14]               0.5  1.0 3261 
b[(Intercept) provincia:15]               0.4  1.0 3944 
b[(Intercept) provincia:16]               0.4  1.0 4316 
b[(Intercept) provincia:17]               0.8  1.0 3068 
b[(Intercept) provincia:18]               0.7  1.0 2495 
b[(Intercept) provincia:19]               0.5  1.0 3371 
b[(Intercept) provincia:20]               0.6  1.0 2774 
b[(Intercept) provincia:21]               0.5  1.0 3028 
b[(Intercept) provincia:22]               0.5  1.0 3017 
b[(Intercept) provincia:23]               0.6  1.0 3011 
b[(Intercept) provincia:24]               0.6  1.0 3277 
sigma                                     0.1  1.0 6673 
Sigma[provincia:(Intercept),(Intercept)] 29.0  1.0 1481 
mean_PPD                                  0.1  1.0 4104 
log-posterior                             0.2  1.0 1014 

For each parameter, mcse is Monte Carlo standard error, n_eff is a crude measure of effective sample size, and Rhat is the potential scale reduction factor on split chains (at convergence Rhat=1).</code></pre>
</div>
</div>
<div class="cell" data-hash="2Modelos-Lineal-y-Mixto_cache/html/unnamed-chunk-93_99999ad77d4b82efcb2f660cb2cd146c">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>y_pred_B <span class="ot">&lt;-</span> <span class="fu">posterior_epred</span>(fit_stan)</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>rowsrandom <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">nrow</span>(y_pred_B), <span class="dv">100</span>)</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>y_pred2 <span class="ot">&lt;-</span> y_pred_B[rowsrandom, ]</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ppc_dens_overlay</span>(<span class="at">y =</span> dataMultinivel<span class="sc">$</span>prom_Ingreso, </span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>                 y_pred2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="2Modelos-Lineal-y-Mixto_files/figure-html/unnamed-chunk-93-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>